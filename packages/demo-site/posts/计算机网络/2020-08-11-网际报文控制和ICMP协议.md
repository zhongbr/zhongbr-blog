---
title: '网际报文控制和ICMP协议'
tags: ['计算机网络']
---
# 网际报文控制和ICMP协议

## ICMP协议

ICMP协议支持主机或者是路由器：

差错（或异常）报告

网络探询

![截屏 2020-08-11 上午8.42.00.png](https://i.loli.net/2020/08/11/OAdXryZb3saUujo.png)

### ICMP差错报文

1. 终点不可达：当路由器或者主机不可交付的时候向源站点发送数据不可达报文
2. 源点抑制：当路由器或者主机由于拥塞而丢弃数据报的时候就应该发送源点抑制报文，使源点知道应该把发送数据的速率放慢。
3. 时间超过：路由器收到生命周期TTL=0的数据报的时候，除了丢弃该报文，还需要向源站点发送时间超过报文。终点不能再预先规定的时间内收到一个数据报的全部数据报片时，把已经
收到的报片丢弃，并且向源站点发送一个时间超过报文。
4. 参数问题：当路由器或者目的主机收到的数据报的首部不正确的时候，会丢弃数据报，并向源点发送参数问题报文。
5. 改变路由（重定向）：路由器把改变路由报文发送给主机，让主机知道下一次应该将数据报发送给另外的路由器，这样可以通过更好的路由器。

![截屏 2020-08-11 上午8.52.20.png](https://i.loli.net/2020/08/11/TmDqxN9kXP4pH2j.png)

以下的情况不会发送ICMP差错报文：

1. 传输**ICMP差错报文**的时候出现差错时，不会再传送ICMP差错报文
2. 对第一个分片的数据报片的所有**后续数据报片**都不再发送ICMP差错报文
3. 对具有**组播地址**的数据报不发送ICMP差错报文
4. 对于特殊地址，如环回地址、0.0.0.0等特殊地址不发送ICMP差错报文

### ICMP询问报文

1. 回送请求和回答报文：主机或者路由器向特定的主机发出询问，收到此报文的主机必须给源主机或路由器发送ICMP回送回答报文。可以用于**测试目的站是否可达以及了解其相关的状态**。
2. 时间戳请求和回答报文：请求某个主机或者路由器回答当前的时间，用来进行时钟的同步和测量时间。
3. 掩码地址请求和回答报文（现在已经不再使用）
4. 路由器询问和通告报文（现在已经不再使用）

### ICMP的应用

1. PING：测试两个主机之间的连通性，使用了ICMP回送请求和回答报文
2. Traceroute：跟踪一个分组从源点到终点的路径，使用了ICMP时间超过差错报告报文（发送一连串生命周期递增1的数据报，可以分别到达不同的路由器，根据路由器返回的ICMP差错报文追踪从源点到终点的路径）。
