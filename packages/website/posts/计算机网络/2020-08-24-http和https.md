---
title: 'http和https'
tags: ['计算机网络', 'http']
recommend: 'frontend'
---
# http和https

## HTTP

超文本传输协议，基于请求与响应、无状态的**应用层协议**。基于**TCP/IP**协议传输数据。

| 版本     | 时间   | 特点                                                         | 现状                 |
| -------- | ------ | ------------------------------------------------------------ | -------------------- |
| HTTP/0.9 | 1991年 | 规定了客户端和服务器通信的格式，只支持GET请求                | 没有作为正式的标准   |
| HTTP/1.0 | 1996年 | 不限制传输的内容，增加了PUT、DELETE、HEAD、OPTIONS、PATCH请求 | 正式作为标准         |
| HTTP/1.1 | 1997年 | 持久连接、节约带宽、HOST域、管道机制、分片传输编码           | 2015年以前应用最广泛 |
| HTTP/2.0 | 2015年 | 多路复用、服务器主动推送、头信息压缩、二进制协议             | 逐渐覆盖市场         |

### 工作原理

基于客户/服务器模式，面向连接。典型过程：

1. 客户端和服务器建立连接
2. 客户向服务器发出请求
3. 服务器接收请求，返回相应的文件作为应答
4. 客户与服务器关闭连接

客户与服务器之间的http请求是一次性的，一次连接只处理一个请求，服务器返回报文后会立即关闭连接，需要再次传输数据时，重新建立连接。

服务器可以建立的TCP连接数量是有限的，为了可以给更多的用户提供服务，所以不会让TCP连接处于等待状态，数据传输完毕之后服务器会立即断开连接提高服务器的执行效率。

### 报文格式

#### 请求报文

HTTP报文由从客户机到服务器的请求和从服务器到客户机的响应构成。

请求行 － 通用信息头 － 请求头 － 实体头 － 报文主体

请求行以方法字段开始，后面分别是 URL 字段和 HTTP 协议版本字段，并以 CRLF 结尾。SP 是分隔符。除了在最后的 CRLF 序列中 CF 和 LF 是必需的之外，其他都可以不要。有关通用信息头，请求头和实体头方面的具体内容可以参照相关文件。

#### 相应报文

应答报文格式如下：

状态行 － 通用信息头 － 响应头 － 实体头 － 报文主体

状态码元由3位数字组成，表示请求是否被理解或被满足。原因分析是对原文的状态码作简短的描述，状态码用来支持自动操作，而原因分析用来供用户使用。客户机无需用来检查或显示语法。有关通用信息头，响应头和实体头方面的具体内容可以参照相关文件。

#### 状态码

##### 1XX：信息

| 状态码                  | 描述                                                   |
| ----------------------- | ------------------------------------------------------ |
| 100 Continue            | 服务器只收到了一部分请求，需要客户端继续发送剩余的请求 |
| 101 Switching Protocols | 转换协议，客户端应该按照要求转移到其他协议             |

##### 2XX：成功

| 状态码                            | 描述                                                         |
| --------------------------------- | ------------------------------------------------------------ |
| 200 OK                            | GET、POST请求成功的相应报文                                  |
| 201 Created                       | 请求被创建完成，新的资源被创建                               |
| 203 Accepted                      | 请求服务器已经收到了，但是还没有处理完毕                     |
| 203 Non-authoritative Information | 文档已经正常地返回，但一些应答头可能不正确，因为使用的是文档的拷贝。 |
| 204 No-Content                    | 没有内容，客户端应该保持原来的内容                           |
| 205 Reset Content                 | 没有内容，客户端应该清除原来的内容，用来强制浏览器清除表单的内容 |
| 206 Partial Conten                | 客户端发送了一个带有Range头的请求，服务端完成了              |

##### 3XX：重定向

| 状态码                 | 描述                                                         |
| ---------------------- | ------------------------------------------------------------ |
| 300 Mutiple Choices    | 多重选择，最多支持5个链接                                    |
| 301 Moved Permanently  | 所请求的页面已经转移到新的url                                |
| 302 Found              | 所请求的页面已经临时转移到新的url                            |
| 303 See Other          | 所请求的页面可以在其他的url找到                              |
| 304 Not Modified       | 未按照预期修改文档，客户端有缓冲文档并发出了一个条件性的请求（带有Modified-Since头的请求，请求比指定的日期更加新的文档），服务器告诉客户端原来的文件还可以继续使用 |
| 305 Use Proxy          | 客户端请求的资源应该通过Location头指定的代理服务获取         |
| 306 Unused             | 请求的资源已经不再使用，但是仍然保留                         |
| 307 Temporary Redirect | 请求的资源临时转移至其他的url                                |

##### 4XX：客户端错误

| 状态码                 | 描述                               |
| ---------------------- | ---------------------------------- |
| 400 Bad Request        | 服务端不理解客户端发送的请求       |
| 401 Unauthorized       | 被请求的页面需要账号密码才可以访问 |
| 402 Payment Required   | 请求的代码无法使用                 |
| 403 Forbidden          | 请求的页面进制访问                 |
| 404 Not Found          | 请求的页面无法找到                 |
| 405 Method Not Allowed | 请求的方法不被允许                 |

##### 5XX

| 状态码                         | 描述                           |
| ------------------------------ | ------------------------------ |
| 500 Internal Server Error      | 请求未完成，服务器遇到未知情况 |
| 501 Not Implemented            | 服务器不支持所请求的功能       |
| 502 Bad Gateway                | 从上游服务器收到一个无效请求   |
| 503 Service Unavailable        | 服务器临时过载或者宕机         |
| 504 Gateway Timeout            | 网关超时                       |
| 505 HTTP Version Not Supported | HTTP版本不被支持               |





******

## HTTPS

HTTP协议虽然应用广泛，但是其是明文传输的，并且缺乏数据完整性校验，安全性低。

HTTPS是在HTTP协议与传输层之间加入SSL/TLS层，对HTTP请求的报文进行加密，然后交给TCP传输层传输。实现对传输安全的保护。

![quicker_5a6075ef-0521-4f48-b92f-499bbbd7d763.png](https://i.loli.net/2020/08/26/mojGs5pZTkNdtEu.png)

【1】Client Hello：客户端发送自己支持的对称加密、非对称加密、哈希算法的列表

【2】Server Hello：服务器回复选择的算法，并返回自己的数字证书（包含自己的公钥、CA的信息和CA机构提供的使用CA机构私钥加密的网站签名信息）

【3】客户端本地验证：客户端根据服务器返回的数字证书内的CA信息，在自己操作系统的根证书列表中找到CA机构的公钥，如果未找到则验证失败。找到CA机构的公钥后，使用CA机构的公钥对数字证书内的签名解密，并于实际的网站信息比对，如果可以对上，则验证通过。

【4】客户端生成随机的密钥：客户端生成随机的传输密钥

【5】复制密钥：客户端复制密钥，使用服务器的公钥加密传输密钥，然后通过tcp连接传输给服务器，服务器使用自己的私钥解密，得到传输密钥

【6】双方使用传输密钥作为密钥，使用对称加密算法加密通信内容
