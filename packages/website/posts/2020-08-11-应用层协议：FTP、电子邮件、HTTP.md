---
title: '应用层协议：FTP、电子邮件、HTTP'
tags: ['计算机网络','应用层','HTTP','FTP','SMTP','POP3']
---
# 应用层协议：FTP、电子邮件、HTTP

## 文件传送协议FTP/TFTP

### 文件传送协议FTP(File Transfer Protocol)

是一种基于客户/服务器模型的，使用TCP传输，提供不同种类的主机系统之间文件传输能力的协议

#### FTP服务器和客户端

用户通过一个客户端程序连接至远程计算机上的服务器程序。

提供文件传送的计算机就是**FTP服务器**

连接FTP服务器，遵循FTP协议与服务器传送文件的计算机就是**客户端**

#### FTP的工作原理

##### 登录

使用FTP地址、用户名和密码登录FTP服务器，有些FTP服务器支持匿名登陆

#### FTP传输模式

##### 文本模式

传输ASCII码传输文本序列数据

##### 二进制模式

以二进制序列传输数据

### 简单文件传送协议TFTP(Trivial File Transfer Protocol)

*****

## 电子邮件 SMTP/POP3

### 电子邮件的格式

- 信封
- 内容
  - 首部
  - 主体

### 电子邮件系统概述——组成结构

![截屏 2020-08-11 下午9.27.40.png](https://i.loli.net/2020/08/11/YZOiIq8UG2JmhHs.png)

- 用户代理：为用户提供电子邮件的界面
  - 撰写
  - 显示
  - 处理
  - 通信
- 邮件服务器：
  - 发送&接收邮件
  - 向发件人报告邮件发送的结果

### SMTP、POP3、IMAP协议

SMTP协议：发邮件

POP3、IMAP协议：收邮件

均使用TCP协议。

#### SMTP协议

建立在TCP连接上，使用25端口

规定了两个SMTP进程之间如何交换信息，负责发送邮件的SMTP进程就是SMTP客户，负责接收邮件的SMTP进程就是SMTP服务器

SMTP固定了14条命令（几个字母）和21中应答（三位数字代码+简单文字说明）

##### 连接建立

建立TCP连接后

1. 接收方邮件服务器向发送方邮件服务器发送【220 Service ready】应答
2. 发送方邮件服务器发送【HELLO】命令给接收方邮件服务器
3. 如果接收方邮件服务器有能力接收邮件就回复【250 OK】应答，否则回复【421 Service not available】

##### 邮件发送

1. 发送方：【MAIL FROM xxx@xxx.xxx】
2. 接收方：【250 OK】回复，表示已经可以开始发送，或者其他回复代表其他含义
3. 发送方：【RCPT TO: <yyy@yyy.yyyy>】告知收件的邮箱，可以是多个邮箱
4. 接收方：【250 OK】(【550 No such user here】)告知发送方是否存在这个用户
5. 发送方：【DARA】表示发送方准备要发送数据了
6. 接收方：【354 start mail input;end with <CR><LF>.<CR><LF>】接收方同意传输
7. 发送方：【Date...】 开始发送数据
8. 接收方：【250 OK】发送结束

##### 连接释放

1. 发送方：【QUIT】发送方申请释放连接
2. 接收方：【221】 同意释放TCP连接

##### SMTP的缺点

1. 不能传送可执行文件或者其他二进制对象
2. 仅限于传送7位的ASCII码，不能传送其他非英语国家的文字
3. SMTP服务器会拒绝超过一定长度的邮件

可以使用**通用因特网邮件扩充MIME**，将非ASCII码的内容转换成ASCII码后传送，以支持声音、图像、视频、多种国家的文字等资源。

#### POP3（邮局协议）

TCP连接，端口号：10

非常简单，功能有限

##### 工作方式

1. 下载并保留（在服务器）
2. 下载并删除

#### IMAP（网际报文存取协议）

IMAP协议比POP3协议复杂得多，用户在PC上打开IMAP邮箱的时候，可以看到邮箱的首部，若用户需要打开某个邮件，该邮件才上传到用户的计算机上。

IMAP可以让用户在不同的地方使用不同的计算机随时上网阅读处理邮件，还允许只读取邮件中的某一个部分。

#### 基于万维网的邮件

与用户代理接触的部分使用的是**http协议**

*****

## 万维网和HTTP协议

万维网(World Wide Web)是一个大规模的、联机式的信息储藏所/资料空间，是无数个网络站点和网页的集合。

所有的资源都有**统一资源定位符URL**：<协议>://<主机>:<端口>/<路径>，除了路径以外的部分不区分大小写。

用户通过点击超链接获取资源，这些资源通过超文本传输协议(HTTP)传送给用户。

万维网也是使用客户/服务器方式工作，用户浏览器就是万维网客户程序，万维网文档所驻留的主机运行服务器程序。

万维网使用超文本标记语言HTML，使得万维网页面设计者可以很方便的从一个界面的连接跳转到另一个页面，并能够在自己的屏幕上显示出来。

### 超文本传输协议

HTTP协议定义了浏览器怎样向万维网服务器请求万维网文档，以及服务器如何将文档传送给浏览器。

![截屏 2020-08-11 下午10.05.22.png](https://i.loli.net/2020/08/11/MCge7Hoqfx5vtzu.png)

#### 具体过程

1. 浏览器分析url
2. 浏览器向dns请求解析ip地址
3. dns解析出ip地址
4. 浏览器与服务器建立tcp连接
5. 浏览器发出取出文件命令
6. 服务器响应
7. 释放tcp连接
8. 浏览器显示

#### 特点

1. 无状态：用户第一次进入网站和以后进入网站是一样的，无记忆的，识别用户可以使用cookie，存储在用户主机内的文本文件，记录一段时间内用户的访问记录
2. 采用tcp作为运输层协议，但是http协议本身是无连接的，通信双方在交换http报文之前不需要先建立http连接的

#### 连接方式

![截屏 2020-08-11 下午10.12.48.png](https://i.loli.net/2020/08/11/L7HkODmBsEzPWvy.png)

1. 非持久连接 (Close)
2. 持久连接 (Keep-Alive)：发送完数据后的一段时间内仍然保持着tcp连接，便于后续继续传输数据
   - 非流水线式：收到服务器响应后才可以发送新的请求
   - 流水线式：可以同时发送请求，服务器依次响应

#### 报文结构

HTTP报文面向文本，报文中的每一个字段都是ASCII码串

![IMG_0028.jpg](https://i.loli.net/2020/08/11/UIYWdzjnfOaPboG.jpg)

1. 请求报文
2. 响应报文

   状态码：
   1xx：通知信息，如收到请求正在处理
   2xx：成功
   3xx：重定向
   4xx：客户端出错，请求中有错误
   5xx：服务器出错无法完成请求
