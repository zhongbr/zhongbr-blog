!function(I,g){"object"==typeof exports&&"undefined"!=typeof module?g(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],g):g((I="undefined"!=typeof globalThis?globalThis:I||self).CodeSandbox={},I.React)}(this,(function(I,g){"use strict";var C,A={},l={};var e,c,o={};
/**
   * @license React
   * react-jsx-runtime.development.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   */function i(){return e||(e=1,"production"!==process.env.NODE_ENV&&function(){var I=g,C=Symbol.for("react.element"),A=Symbol.for("react.portal"),l=Symbol.for("react.fragment"),e=Symbol.for("react.strict_mode"),c=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),Z=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),b=Symbol.for("react.suspense"),t=Symbol.for("react.suspense_list"),n=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),a=Symbol.for("react.offscreen"),G=Symbol.iterator;var m=I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function r(I){for(var g=arguments.length,C=new Array(g>1?g-1:0),A=1;A<g;A++)C[A-1]=arguments[A];y("error",I,C)}function y(I,g,C){var A=m.ReactDebugCurrentFrame.getStackAddendum();""!==A&&(g+="%s",C=C.concat([A]));var l=C.map((function(I){return String(I)}));l.unshift("Warning: "+g),Function.prototype.apply.call(console[I],console,l)}var W;function B(I){return I.displayName||"Context"}function u(I){if(null==I)return null;if("number"==typeof I.tag&&r("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),"function"==typeof I)return I.displayName||I.name||null;if("string"==typeof I)return I;switch(I){case l:return"Fragment";case A:return"Portal";case c:return"Profiler";case e:return"StrictMode";case b:return"Suspense";case t:return"SuspenseList"}if("object"==typeof I)switch(I.$$typeof){case Z:return B(I)+".Consumer";case i:return B(I._context)+".Provider";case s:return function(I,g,C){var A=I.displayName;if(A)return A;var l=g.displayName||g.name||"";return""!==l?C+"("+l+")":C}(I,I.render,"ForwardRef");case n:var g=I.displayName||null;return null!==g?g:u(I.type)||"Memo";case d:var C=I,o=C._payload,a=C._init;try{return u(a(o))}catch(G){return null}}return null}W=Symbol.for("react.module.reference");var V,p,Y,X,h,H,K,R=Object.assign,w=0;function f(){}f.__reactDisabledLog=!0;var N,S=m.ReactCurrentDispatcher;function F(I,g,C){if(void 0===N)try{throw Error()}catch(l){var A=l.stack.trim().match(/\n( *(at )?)/);N=A&&A[1]||""}return"\n"+N+I}var v,k=!1,J="function"==typeof WeakMap?WeakMap:Map;function T(I,g){if(!I||k)return"";var C,A=v.get(I);if(void 0!==A)return A;k=!0;var l,e=Error.prepareStackTrace;Error.prepareStackTrace=void 0,l=S.current,S.current=null,function(){if(0===w){V=console.log,p=console.info,Y=console.warn,X=console.error,h=console.group,H=console.groupCollapsed,K=console.groupEnd;var I={configurable:!0,enumerable:!0,value:f,writable:!0};Object.defineProperties(console,{info:I,log:I,warn:I,error:I,group:I,groupCollapsed:I,groupEnd:I})}w++}();try{if(g){var c=function(){throw Error()};if(Object.defineProperty(c.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(c,[])}catch(d){C=d}Reflect.construct(I,[],c)}else{try{c.call()}catch(d){C=d}I.call(c.prototype)}}else{try{throw Error()}catch(d){C=d}I()}}catch(a){if(a&&C&&"string"==typeof a.stack){for(var o=a.stack.split("\n"),i=C.stack.split("\n"),Z=o.length-1,s=i.length-1;Z>=1&&s>=0&&o[Z]!==i[s];)s--;for(;Z>=1&&s>=0;Z--,s--)if(o[Z]!==i[s]){if(1!==Z||1!==s)do{if(Z--,--s<0||o[Z]!==i[s]){var b="\n"+o[Z].replace(" at new "," at ");return I.displayName&&b.includes("<anonymous>")&&(b=b.replace("<anonymous>",I.displayName)),"function"==typeof I&&v.set(I,b),b}}while(Z>=1&&s>=0);break}}}finally{k=!1,S.current=l,function(){if(0==--w){var I={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:R({},I,{value:V}),info:R({},I,{value:p}),warn:R({},I,{value:Y}),error:R({},I,{value:X}),group:R({},I,{value:h}),groupCollapsed:R({},I,{value:H}),groupEnd:R({},I,{value:K})})}w<0&&r("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}(),Error.prepareStackTrace=e}var t=I?I.displayName||I.name:"",n=t?F(t):"";return"function"==typeof I&&v.set(I,n),n}function U(I,g,C){if(null==I)return"";if("function"==typeof I)return T(I,!(!(A=I.prototype)||!A.isReactComponent));var A;if("string"==typeof I)return F(I);switch(I){case b:return F("Suspense");case t:return F("SuspenseList")}if("object"==typeof I)switch(I.$$typeof){case s:return T(I.render,!1);case n:return U(I.type,g,C);case d:var l=I,e=l._payload,c=l._init;try{return U(c(e),g,C)}catch(o){}}return""}v=new J;var x=Object.prototype.hasOwnProperty,z={},Q=m.ReactDebugCurrentFrame;function D(I){if(I){var g=I._owner,C=U(I.type,I._source,g?g.type:null);Q.setExtraStackFrame(C)}else Q.setExtraStackFrame(null)}var P=Array.isArray;function L(I){return P(I)}function j(I){return""+I}function O(I){if(function(I){try{return j(I),!1}catch(g){return!0}}(I))return r("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",function(I){return"function"==typeof Symbol&&Symbol.toStringTag&&I[Symbol.toStringTag]||I.constructor.name||"Object"}(I)),j(I)}var M,E,_,$=m.ReactCurrentOwner,q={key:!0,ref:!0,__self:!0,__source:!0};_={};function II(I,g,A,l,e){var c,o={},i=null,Z=null;for(c in void 0!==A&&(O(A),i=""+A),function(I){if(x.call(I,"key")){var g=Object.getOwnPropertyDescriptor(I,"key").get;if(g&&g.isReactWarning)return!1}return void 0!==I.key}(g)&&(O(g.key),i=""+g.key),function(I){if(x.call(I,"ref")){var g=Object.getOwnPropertyDescriptor(I,"ref").get;if(g&&g.isReactWarning)return!1}return void 0!==I.ref}(g)&&(Z=g.ref,function(I,g){if("string"==typeof I.ref&&$.current&&g&&$.current.stateNode!==g){var C=u($.current.type);_[C]||(r('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',u($.current.type),I.ref),_[C]=!0)}}(g,e)),g)x.call(g,c)&&!q.hasOwnProperty(c)&&(o[c]=g[c]);if(I&&I.defaultProps){var s=I.defaultProps;for(c in s)void 0===o[c]&&(o[c]=s[c])}if(i||Z){var b="function"==typeof I?I.displayName||I.name||"Unknown":I;i&&function(I,g){var C=function(){M||(M=!0,r("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",g))};C.isReactWarning=!0,Object.defineProperty(I,"key",{get:C,configurable:!0})}(o,b),Z&&function(I,g){var C=function(){E||(E=!0,r("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",g))};C.isReactWarning=!0,Object.defineProperty(I,"ref",{get:C,configurable:!0})}(o,b)}return function(I,g,A,l,e,c,o){var i={$$typeof:C,type:I,key:g,ref:A,props:o,_owner:c,_store:{}};return Object.defineProperty(i._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(i,"_self",{configurable:!1,enumerable:!1,writable:!1,value:l}),Object.defineProperty(i,"_source",{configurable:!1,enumerable:!1,writable:!1,value:e}),Object.freeze&&(Object.freeze(i.props),Object.freeze(i)),i}(I,i,Z,e,l,$.current,o)}var gI,CI=m.ReactCurrentOwner,AI=m.ReactDebugCurrentFrame;function lI(I){if(I){var g=I._owner,C=U(I.type,I._source,g?g.type:null);AI.setExtraStackFrame(C)}else AI.setExtraStackFrame(null)}function eI(I){return"object"==typeof I&&null!==I&&I.$$typeof===C}function cI(){if(CI.current){var I=u(CI.current.type);if(I)return"\n\nCheck the render method of `"+I+"`."}return""}gI=!1;var oI={};function iI(I,g){if(I._store&&!I._store.validated&&null==I.key){I._store.validated=!0;var C=function(I){var g=cI();if(!g){var C="string"==typeof I?I:I.displayName||I.name;C&&(g="\n\nCheck the top-level render call using <"+C+">.")}return g}(g);if(!oI[C]){oI[C]=!0;var A="";I&&I._owner&&I._owner!==CI.current&&(A=" It was passed a child from "+u(I._owner.type)+"."),lI(I),r('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',C,A),lI(null)}}}function ZI(I,g){if("object"==typeof I)if(L(I))for(var C=0;C<I.length;C++){var A=I[C];eI(A)&&iI(A,g)}else if(eI(I))I._store&&(I._store.validated=!0);else if(I){var l=function(I){if(null===I||"object"!=typeof I)return null;var g=G&&I[G]||I["@@iterator"];return"function"==typeof g?g:null}(I);if("function"==typeof l&&l!==I.entries)for(var e,c=l.call(I);!(e=c.next()).done;)eI(e.value)&&iI(e.value,g)}}function sI(I){var g,C=I.type;if(null!=C&&"string"!=typeof C){if("function"==typeof C)g=C.propTypes;else{if("object"!=typeof C||C.$$typeof!==s&&C.$$typeof!==n)return;g=C.propTypes}if(g){var A=u(C);!function(I,g,C,A,l){var e=Function.call.bind(x);for(var c in I)if(e(I,c)){var o=void 0;try{if("function"!=typeof I[c]){var i=Error((A||"React class")+": "+C+" type `"+c+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof I[c]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw i.name="Invariant Violation",i}o=I[c](g,c,A,C,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(Z){o=Z}!o||o instanceof Error||(D(l),r("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",A||"React class",C,c,typeof o),D(null)),o instanceof Error&&!(o.message in z)&&(z[o.message]=!0,D(l),r("Failed %s type: %s",C,o.message),D(null))}}(g,I.props,"prop",A,I)}else if(void 0!==C.PropTypes&&!gI){gI=!0,r("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",u(C)||"Unknown")}"function"!=typeof C.getDefaultProps||C.getDefaultProps.isReactClassApproved||r("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function bI(I,g,A,o,G,m){var y=function(I){return"string"==typeof I||"function"==typeof I||I===l||I===c||I===e||I===b||I===t||I===a||"object"==typeof I&&null!==I&&(I.$$typeof===d||I.$$typeof===n||I.$$typeof===i||I.$$typeof===Z||I.$$typeof===s||I.$$typeof===W||void 0!==I.getModuleId)}(I);if(!y){var B="";(void 0===I||"object"==typeof I&&null!==I&&0===Object.keys(I).length)&&(B+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var V,p=function(I){return void 0!==I?"\n\nCheck your code at "+I.fileName.replace(/^.*[\\\/]/,"")+":"+I.lineNumber+".":""}(G);B+=p||cI(),null===I?V="null":L(I)?V="array":void 0!==I&&I.$$typeof===C?(V="<"+(u(I.type)||"Unknown")+" />",B=" Did you accidentally export a JSX literal instead of a component?"):V=typeof I,r("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",V,B)}var Y=II(I,g,A,G,m);if(null==Y)return Y;if(y){var X=g.children;if(void 0!==X)if(o)if(L(X)){for(var h=0;h<X.length;h++)ZI(X[h],I);Object.freeze&&Object.freeze(X)}else r("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else ZI(X,I)}return I===l?function(I){for(var g=Object.keys(I.props),C=0;C<g.length;C++){var A=g[C];if("children"!==A&&"key"!==A){lI(I),r("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",A),lI(null);break}}null!==I.ref&&(lI(I),r("Invalid attribute `ref` supplied to `React.Fragment`."),lI(null))}(Y):sI(Y),Y}var tI=function(I,g,C){return bI(I,g,C,!1)},nI=function(I,g,C){return bI(I,g,C,!0)};o.Fragment=l,o.jsx=tI,o.jsxs=nI}()),o}c={get exports(){return A},set exports(I){A=I}},"production"===process.env.NODE_ENV?c.exports=function(){if(C)return l;C=1;var I=g,A=Symbol.for("react.element"),e=Symbol.for("react.fragment"),c=Object.prototype.hasOwnProperty,o=I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function Z(I,g,C){var l,e={},Z=null,s=null;for(l in void 0!==C&&(Z=""+C),void 0!==g.key&&(Z=""+g.key),void 0!==g.ref&&(s=g.ref),g)c.call(g,l)&&!i.hasOwnProperty(l)&&(e[l]=g[l]);if(I&&I.defaultProps)for(l in g=I.defaultProps)void 0===e[l]&&(e[l]=g[l]);return{$$typeof:A,type:I,key:Z,ref:s,props:e,_owner:o.current}}return l.Fragment=e,l.jsx=Z,l.jsxs=Z,l}():c.exports=i();const Z=A.Fragment,s=A.jsx,b=A.jsxs,t=["log","debug"].reduce(((I,g)=>Object.assign(I,{[g]:(...I)=>null})),{});let n=0;const d=()=>n++,a=new Set,G=new Map;function m(I,g){if(a.has(I))return;a.add(I);const C=G.get(I);C&&C.forEach((I=>I()));const A=async C=>{var A;const l=C.data;if("call"===Reflect.get(l,"__proxy_internal")&&l.receiver===I){const I=Reflect.get(g,l.method);I||(C.source||self).postMessage({__proxy_internal:"reply",id:l.id,error:!0,payload:[`[proxy] method \`${l.method}\` does not exist on remote object ${l.receiver} or it is not a function.`]});let e=I;"function"==typeof I&&(e=await I.call(g,...l.payload,C)),t.debug("[proxy] reply",(null==(A=null==self?void 0:self.location)?void 0:A.href)||"worker",C.source,l.receiver,l.method,C.source||self),(C.source||self).postMessage({__proxy_internal:"reply",id:l.id,error:!1,payload:[e]})}};return self.addEventListener("message",A),()=>{self.removeEventListener("message",A)}}async function r(I,g,C=1e4){return new Promise(((A,l)=>{const e=d(),c=setTimeout((()=>{self.removeEventListener("message",o),l(`[proxy] wait for ${g} timeout .`)}),C),o=g=>{if((g.source||self)!==I)return;const C=g.data;"wait-reply"===Reflect.get(C,"__proxy_internal")&&C.id===e&&(A(null),clearTimeout(c),self.removeEventListener("message",o))};self.addEventListener("message",o),I.postMessage({__proxy_internal:"wait",receiver:g,payload:[],error:!1,id:e})}))}async function y({win:I,serviceId:g,method:C,payload:A,timeout:l=1e4}){return new Promise(((e,c)=>{var o;const i=d();let Z=self;I instanceof Worker&&(Z=I);let s=setTimeout((()=>{c(`call remote object ${g} method ${C.toString()} timeout`),Z.removeEventListener("message",b)}),l);const b=g=>{var C;if(!(I instanceof Worker)&&(g.source||self)!==I)return;const A=g.data;"reply"===Reflect.get(A,"__proxy_internal")&&A.id===i&&(Z.removeEventListener("message",b),clearTimeout(s),t.debug("[proxy] receive reply",(null==(C=null==self?void 0:self.location)?void 0:C.href)||"worker",A.id),A.error?c(A.payload[0]):e(A.payload[0]))};Z.addEventListener("message",b),t.debug("[proxy] call",(null==(o=null==self?void 0:self.location)?void 0:o.href)||"worker",g,C),I.postMessage({id:i,__proxy_internal:"call",receiver:g,method:C,payload:A,error:!1})}))}self.addEventListener("message",(I=>{const g=I.data;if("wait"!==Reflect.get(g,"__proxy_internal"))return;const C=g.receiver,A=setTimeout((()=>{const A=(G.get(C)||[]).filter((I=>I!==l));G.set(C,A),(I.source||self).postMessage({__proxy_internal:"wait-reply",error:!0,id:g.id,payload:[`[proxy]wait for service ${C} timeout.`]})}),g.timeout),l=()=>{clearTimeout(A),(I.source||self).postMessage({__proxy_internal:"wait-reply",id:g.id,error:!1,payload:[]});const e=(G.get(C)||[]).filter((I=>I!==l));G.set(C,e)},e=G.get(C)||[];e.push(l),G.set(C,e),a.has(C)&&l()}));const W="iframe-notification-service",B=(()=>{const I=new Map;return{trigger:(g,...C)=>{const A=I.get(g);if(A){const l=new Map;A.forEach(((I,g)=>{I.filter&&!I.filter(...C)||(I(...C),I.once&&l.set(g,!0))})),I.set(g,A.filter(((I,g)=>!l.get(g))))}},listen:(g,C,A)=>{var l,e;return I.has(g)||I.set(g,[]),null==(e=null==(l=I.get(g))?void 0:l.push)||e.call(l,Object.assign(C,{filter:A})),()=>{var A;null==(A=I.get(g))||A.filter((I=>I!==C))}},once:(g,C,A,l,e=-1)=>{var c,o;I.has(g)||I.set(g,[]);const i=()=>{var A;null==(A=I.get(g))||A.filter((I=>I!==C))};let Z;return-1!==e&&(Z=setTimeout((()=>{i(),null==l||l()}),e)),null==(o=null==(c=I.get(g))?void 0:c.push)||o.call(c,Object.assign(((...I)=>{Z&&clearTimeout(Z),C(...I)}),{once:!0,filter:A})),i}}})(),u=async(I,g=1e4)=>{const C=new Promise(((C,A)=>{"loaded"!==I.getAttribute("data-iframe-status")?B.once("iframeReady",((...g)=>{I.setAttribute("data-iframe-status","loaded"),C(null)}),(g=>g.source===I.contentWindow),A,g):C(null)})),A=y({win:I.contentWindow,serviceId:W,method:"iframeReady",payload:[],timeout:g});return Promise.race([C,A])},V="demo-service",p="// âš ï¸require function is asynchronous !\n// const React = await require('react');\nimport React from 'react';\n\nconst App = () => {\n    return (\n        React.createElement(\n            'div',\n            {},\n            React.createElement(\n                'div',\n                {\n                    className: 'title'\n                },\n                'DemoSandbox'\n            ),\n            'welcome to use code sandbox'\n        )\n    );\n};\n\nmodule.exports = App",Y="const React = await require('react');\nconst ReactDom = await require('react-dom');\nconst App = await require('./App');\n\nReactDom.render(React.createElement(App, {}), document.getElementById('root'));",X='<noscript>Need javascript to run this demo page.</noscript>\n<div id="root">\n    <h3> ðŸš€ Welcome to use code sandbox. </h3>\n</div>',h=".title { color: blue }",H=Object.freeze(Object.defineProperty({__proto__:null,DefaultCssCode:h,DefaultDemoCode:p,DefaultHtml:X,DefaultIndexCode:Y},Symbol.toStringTag,{value:"Module"}));class K{constructor(){this.pluginId="base"}async resolveModuleUrl(I){return I}async require(I,g){return g}async beforeModuleGenerate(I,g){return g}}let R=[];class w extends K{constructor(){super(),this.pluginId="default-plugin"}async resolveModuleUrl(I){const{packageName:g,version:C,file:A}=I;return`https://unpkg.com/${g}${C?`@${C}`:""}${A?`${A}`:""}`}async beforeModuleGenerate(I,g){return g.factory=`async (require, exports, module) => {\n${g.factory}\n}`,g.deps=["require","exports","module"],g}}(async()=>{m(W,{iframeReady:async I=>(console.log("iframe ready",I),B.trigger("iframeReady",I),!0),iframeLoadingModule:async(I,g,C)=>{B.trigger("iframeLoadingModule",I,g,C)}})})();const f=I=>{const{title:C="demo",className:A,code:l=p,index:e=Y,css:c=h,html:o=X,style:i,onLoadingModule:t,onReady:n}=I,d=g.useRef(null),a=g.useRef(null),G=[o,l,e,c];g.useLayoutEffect((()=>{(async()=>{const{refreshIndex:I,refreshApp:g,refreshHtml:C,refreshStyle:A}=(I=>{const{iframe:g,code:C,index:A,html:l,css:e,className:c,style:o}=I,i=async(I,C,A)=>{g&&A&&(await u(g),await r(g.contentWindow,V),await y({win:g.contentWindow,serviceId:V,method:"defineModule",payload:[I,C,A]}),await y({win:g.contentWindow,serviceId:V,method:"executeModule",payload:[I]}))},Z=async()=>{await i("/index",["require"],A)},s=async()=>{await i("/App",["require"],C),await Z()};return{refreshApp:s,refreshIndex:Z,refreshHtml:async()=>{await u(g),await r(g.contentWindow,V),await y({win:g.contentWindow,serviceId:V,method:"setBodyHtml",payload:[l]}),await s()},refreshStyle:async()=>{g&&e&&(await u(g),await r(g.contentWindow,V),await y({win:g.contentWindow,serviceId:V,method:"setStyle",payload:[e]}))}}})({iframe:d.current,code:l,index:e,css:c,html:o}),[i,Z,s,b]=a.current||[],t=[];switch(!0){case i!==o:t.push(C());break;case Z!==l:t.push(g());break;case s!==e:t.push(I())}t.push(A()),await Promise.all(t),null==n||n(),a.current=G})()}),G);const m=g.useRef(t);m.current=t,g.useLayoutEffect((()=>{d.current&&(((I,g)=>{B.listen("iframeLoadingModule",g,((g,C,A)=>A.source===I.contentWindow))})(d.current,((I,g)=>{m.current(I,g)})),(async(I,g)=>{await u(I),await r(I.contentWindow,V),await y({win:I.contentWindow,serviceId:V,method:"setPlugins",payload:[g]})})(d.current,R))}),[]);const[W,H]=(()=>{const I='<html lang="en">\n    <head>\n        <title>Demo Sandbox</title>\n        <script type="module" src="data:application/javascript;base64,Y29uc3QgZGVidWdPbmx5TGV2ZWwgPSBbImxvZyIsICJkZWJ1ZyJdOwpjb25zdCBsb2dnZXIgPSBkZWJ1Z09ubHlMZXZlbC5yZWR1Y2UoKHByZSwga2V5KSA9PiB7CiAgcmV0dXJuIE9iamVjdC5hc3NpZ24ocHJlLCB7CiAgICBba2V5XTogKC4uLmFyZ3MpID0+IHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfSk7Cn0sIHt9KTsKbGV0IE1lc3NhZ2VJRCA9IDA7CmNvbnN0IGdldE1lc3NhZ2VJZCA9ICgpID0+IE1lc3NhZ2VJRCsrOwpjb25zdCBzZXJ2aWNlcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCk7CmNvbnN0IHdhaXRTZXJ2aWNlQ2FsbGJhY2tzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTsKc2VsZi5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgKGUpID0+IHsKICBjb25zdCBtZXNzYWdlID0gZS5kYXRhOwogIGlmIChSZWZsZWN0LmdldChtZXNzYWdlLCAiX19wcm94eV9pbnRlcm5hbCIpICE9PSAid2FpdCIpIHsKICAgIHJldHVybjsKICB9CiAgY29uc3Qgc2VydmljZUlkID0gbWVzc2FnZS5yZWNlaXZlcjsKICBjb25zdCB0aW1lb3V0XyA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgY29uc3QgY2FsbGJhY2tzMiA9ICh3YWl0U2VydmljZUNhbGxiYWNrcy5nZXQoc2VydmljZUlkKSB8fCBbXSkuZmlsdGVyKChjKSA9PiBjICE9PSBjYWxsYmFjayk7CiAgICB3YWl0U2VydmljZUNhbGxiYWNrcy5zZXQoc2VydmljZUlkLCBjYWxsYmFja3MyKTsKICAgIChlLnNvdXJjZSB8fCBzZWxmKS5wb3N0TWVzc2FnZSh7CiAgICAgIF9fcHJveHlfaW50ZXJuYWw6ICJ3YWl0LXJlcGx5IiwKICAgICAgZXJyb3I6IHRydWUsCiAgICAgIGlkOiBtZXNzYWdlLmlkLAogICAgICBwYXlsb2FkOiBbYFtwcm94eV13YWl0IGZvciBzZXJ2aWNlICR7c2VydmljZUlkfSB0aW1lb3V0LmBdCiAgICB9KTsKICB9LCBtZXNzYWdlLnRpbWVvdXQpOwogIGNvbnN0IGNhbGxiYWNrID0gKCkgPT4gewogICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRfKTsKICAgIChlLnNvdXJjZSB8fCBzZWxmKS5wb3N0TWVzc2FnZSh7CiAgICAgIF9fcHJveHlfaW50ZXJuYWw6ICJ3YWl0LXJlcGx5IiwKICAgICAgaWQ6IG1lc3NhZ2UuaWQsCiAgICAgIGVycm9yOiBmYWxzZSwKICAgICAgcGF5bG9hZDogW10KICAgIH0pOwogICAgY29uc3QgY2FsbGJhY2tzMiA9ICh3YWl0U2VydmljZUNhbGxiYWNrcy5nZXQoc2VydmljZUlkKSB8fCBbXSkuZmlsdGVyKChjKSA9PiBjICE9PSBjYWxsYmFjayk7CiAgICB3YWl0U2VydmljZUNhbGxiYWNrcy5zZXQoc2VydmljZUlkLCBjYWxsYmFja3MyKTsKICB9OwogIGNvbnN0IGNhbGxiYWNrcyA9IHdhaXRTZXJ2aWNlQ2FsbGJhY2tzLmdldChzZXJ2aWNlSWQpIHx8IFtdOwogIGNhbGxiYWNrcy5wdXNoKGNhbGxiYWNrKTsKICB3YWl0U2VydmljZUNhbGxiYWNrcy5zZXQoc2VydmljZUlkLCBjYWxsYmFja3MpOwogIGlmIChzZXJ2aWNlcy5oYXMoc2VydmljZUlkKSkgewogICAgY2FsbGJhY2soKTsKICB9Cn0pOwpmdW5jdGlvbiByZWdpc3RlclByb3h5KHNlcnZpY2VJZCwgb2JqKSB7CiAgaWYgKHNlcnZpY2VzLmhhcyhzZXJ2aWNlSWQpKSB7CiAgICByZXR1cm47CiAgfQogIHNlcnZpY2VzLmFkZChzZXJ2aWNlSWQpOwogIGNvbnN0IGNhbGxiYWNrcyA9IHdhaXRTZXJ2aWNlQ2FsbGJhY2tzLmdldChzZXJ2aWNlSWQpOwogIGlmIChjYWxsYmFja3MpCiAgICBjYWxsYmFja3MuZm9yRWFjaCgoY2FsbGJhY2spID0+IGNhbGxiYWNrKCkpOwogIGNvbnN0IHNlcnZpY2VIYW5kbGVyID0gYXN5bmMgKGUpID0+IHsKICAgIHZhciBfYTsKICAgIGNvbnN0IG1lc3NhZ2UgPSBlLmRhdGE7CiAgICBpZiAoUmVmbGVjdC5nZXQobWVzc2FnZSwgIl9fcHJveHlfaW50ZXJuYWwiKSAhPT0gImNhbGwiKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChtZXNzYWdlLnJlY2VpdmVyID09PSBzZXJ2aWNlSWQpIHsKICAgICAgY29uc3QgbWV0aG9kID0gUmVmbGVjdC5nZXQob2JqLCBtZXNzYWdlLm1ldGhvZCk7CiAgICAgIGlmICghbWV0aG9kKSB7CiAgICAgICAgKGUuc291cmNlIHx8IHNlbGYpLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIF9fcHJveHlfaW50ZXJuYWw6ICJyZXBseSIsCiAgICAgICAgICBpZDogbWVzc2FnZS5pZCwKICAgICAgICAgIGVycm9yOiB0cnVlLAogICAgICAgICAgcGF5bG9hZDogW2BbcHJveHldIG1ldGhvZCBcYCR7bWVzc2FnZS5tZXRob2R9XGAgZG9lcyBub3QgZXhpc3Qgb24gcmVtb3RlIG9iamVjdCAke21lc3NhZ2UucmVjZWl2ZXJ9IG9yIGl0IGlzIG5vdCBhIGZ1bmN0aW9uLmBdCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgbGV0IHJlcyA9IG1ldGhvZDsKICAgICAgaWYgKHR5cGVvZiBtZXRob2QgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICByZXMgPSBhd2FpdCBtZXRob2QuY2FsbChvYmosIC4uLm1lc3NhZ2UucGF5bG9hZCwgZSk7CiAgICAgIH0KICAgICAgbG9nZ2VyLmRlYnVnKCJbcHJveHldIHJlcGx5IiwgKChfYSA9IHNlbGYgPT0gbnVsbCA/IHZvaWQgMCA6IHNlbGYubG9jYXRpb24pID09IG51bGwgPyB2b2lkIDAgOiBfYS5ocmVmKSB8fCAid29ya2VyIiwgZS5zb3VyY2UsIG1lc3NhZ2UucmVjZWl2ZXIsIG1lc3NhZ2UubWV0aG9kLCBlLnNvdXJjZSB8fCBzZWxmKTsKICAgICAgaWYgKHJlcyBpbnN0YW5jZW9mIFByb21pc2UpIHsKICAgICAgICBkZWJ1Z2dlcjsKICAgICAgfQogICAgICAoZS5zb3VyY2UgfHwgc2VsZikucG9zdE1lc3NhZ2UoewogICAgICAgIF9fcHJveHlfaW50ZXJuYWw6ICJyZXBseSIsCiAgICAgICAgaWQ6IG1lc3NhZ2UuaWQsCiAgICAgICAgZXJyb3I6IGZhbHNlLAogICAgICAgIHBheWxvYWQ6IFtyZXNdCiAgICAgIH0pOwogICAgfQogIH07CiAgc2VsZi5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgc2VydmljZUhhbmRsZXIpOwogIHJldHVybiAoKSA9PiB7CiAgICBzZWxmLnJlbW92ZUV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCBzZXJ2aWNlSGFuZGxlcik7CiAgfTsKfQphc3luYyBmdW5jdGlvbiB3YWl0UHJveHkod2luLCBzZXJ2aWNlSWQsIHRpbWVvdXQgPSAxZTQpIHsKICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUzLCByZWplY3QpID0+IHsKICAgIGNvbnN0IG1lc3NhZ2VJZCA9IGdldE1lc3NhZ2VJZCgpOwogICAgY29uc3QgdGltZW91dF8gPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgc2VsZi5yZW1vdmVFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgY2FsbGJhY2spOwogICAgICByZWplY3QoYFtwcm94eV0gd2FpdCBmb3IgJHtzZXJ2aWNlSWR9IHRpbWVvdXQgLmApOwogICAgfSwgdGltZW91dCk7CiAgICBjb25zdCBjYWxsYmFjayA9IChlKSA9PiB7CiAgICAgIGlmICgoZS5zb3VyY2UgfHwgc2VsZikgIT09IHdpbikKICAgICAgICByZXR1cm47CiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBlLmRhdGE7CiAgICAgIGlmIChSZWZsZWN0LmdldChtZXNzYWdlLCAiX19wcm94eV9pbnRlcm5hbCIpICE9PSAid2FpdC1yZXBseSIgfHwgbWVzc2FnZS5pZCAhPT0gbWVzc2FnZUlkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHJlc29sdmUzKG51bGwpOwogICAgICBjbGVhclRpbWVvdXQodGltZW91dF8pOwogICAgICBzZWxmLnJlbW92ZUV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCBjYWxsYmFjayk7CiAgICB9OwogICAgc2VsZi5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgY2FsbGJhY2spOwogICAgd2luLnBvc3RNZXNzYWdlKHsKICAgICAgX19wcm94eV9pbnRlcm5hbDogIndhaXQiLAogICAgICByZWNlaXZlcjogc2VydmljZUlkLAogICAgICBwYXlsb2FkOiBbXSwKICAgICAgZXJyb3I6IGZhbHNlLAogICAgICBpZDogbWVzc2FnZUlkCiAgICB9KTsKICB9KTsKfQphc3luYyBmdW5jdGlvbiBjYWxsUHJveHkoeyB3aW4sIHNlcnZpY2VJZCwgbWV0aG9kLCBwYXlsb2FkLCB0aW1lb3V0ID0gMWU0IH0pIHsKICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUzLCByZWplY3QpID0+IHsKICAgIHZhciBfYTsKICAgIGNvbnN0IG1lc3NhZ2VJZCA9IGdldE1lc3NhZ2VJZCgpOwogICAgbGV0IGhhbmRsZXIgPSBzZWxmOwogICAgaWYgKHdpbiBpbnN0YW5jZW9mIFdvcmtlcikgewogICAgICBoYW5kbGVyID0gd2luOwogICAgfQogICAgbGV0IHRpbWVvdXRfID0gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgIHJlamVjdChgY2FsbCByZW1vdGUgb2JqZWN0ICR7c2VydmljZUlkfSBtZXRob2QgJHttZXRob2QudG9TdHJpbmcoKX0gdGltZW91dGApOwogICAgICBoYW5kbGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCBjYWxsYmFjayk7CiAgICB9LCB0aW1lb3V0KTsKICAgIGNvbnN0IGNhbGxiYWNrID0gKGUpID0+IHsKICAgICAgdmFyIF9hMjsKICAgICAgaWYgKCEod2luIGluc3RhbmNlb2YgV29ya2VyKSAmJiAoZS5zb3VyY2UgfHwgc2VsZikgIT09IHdpbikKICAgICAgICByZXR1cm47CiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBlLmRhdGE7CiAgICAgIGlmIChSZWZsZWN0LmdldChtZXNzYWdlLCAiX19wcm94eV9pbnRlcm5hbCIpICE9PSAicmVwbHkiIHx8IG1lc3NhZ2UuaWQgIT09IG1lc3NhZ2VJZCkKICAgICAgICByZXR1cm47CiAgICAgIGhhbmRsZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsIGNhbGxiYWNrKTsKICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRfKTsKICAgICAgbG9nZ2VyLmRlYnVnKCJbcHJveHldIHJlY2VpdmUgcmVwbHkiLCAoKF9hMiA9IHNlbGYgPT0gbnVsbCA/IHZvaWQgMCA6IHNlbGYubG9jYXRpb24pID09IG51bGwgPyB2b2lkIDAgOiBfYTIuaHJlZikgfHwgIndvcmtlciIsIG1lc3NhZ2UuaWQpOwogICAgICBpZiAobWVzc2FnZS5lcnJvcikgewogICAgICAgIHJlamVjdChtZXNzYWdlLnBheWxvYWRbMF0pOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICByZXNvbHZlMyhtZXNzYWdlLnBheWxvYWRbMF0pOwogICAgfTsKICAgIGhhbmRsZXIuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsIGNhbGxiYWNrKTsKICAgIGxvZ2dlci5kZWJ1ZygiW3Byb3h5XSBjYWxsIiwgKChfYSA9IHNlbGYgPT0gbnVsbCA/IHZvaWQgMCA6IHNlbGYubG9jYXRpb24pID09IG51bGwgPyB2b2lkIDAgOiBfYS5ocmVmKSB8fCAid29ya2VyIiwgc2VydmljZUlkLCBtZXRob2QpOwogICAgd2luLnBvc3RNZXNzYWdlKHsKICAgICAgaWQ6IG1lc3NhZ2VJZCwKICAgICAgX19wcm94eV9pbnRlcm5hbDogImNhbGwiLAogICAgICByZWNlaXZlcjogc2VydmljZUlkLAogICAgICBtZXRob2QsCiAgICAgIHBheWxvYWQsCiAgICAgIGVycm9yOiBmYWxzZQogICAgfSk7CiAgfSk7Cn0KZnVuY3Rpb24gYmluZFNjcmlwdExvYWRlclRvQ3R4KGN0eDIpIHsKICBsZXQgbG9hZGluZ01vZHVsZU5hbWUgPSAiIjsKICBjb25zdCBzY3JpcHRMb2FkaW5nVGFza3MgPSBbXTsKICBjb25zdCBsb2FkU2NyaXB0ID0gYXN5bmMgKGRvbSwgdXJsLCBtb2R1bGVOYW1lMiA9ICJnbG9iYWxPYmoiKSA9PiB7CiAgICBpZiAobG9hZGluZ01vZHVsZU5hbWUpIHsKICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUzKSA9PiB7CiAgICAgICAgcmVzb2x2ZTMubW9kdWxlTmFtZSA9IG1vZHVsZU5hbWUyOwogICAgICAgIHNjcmlwdExvYWRpbmdUYXNrcy5wdXNoKHJlc29sdmUzKTsKICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUzLCByZWplY3QpID0+IHsKICAgICAgY29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7CiAgICAgIGNvbnN0IHRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICB2YXIgX2E7CiAgICAgICAgY3R4Mi5sb2dnZXIubG9nKCJbYW1kXSBzY3JpcHQgbG9hZCB0aW1lb3V0ICIgKyBtb2R1bGVOYW1lMik7CiAgICAgICAgcmVqZWN0KG5ldyBFcnJvcihgbG9hZCBtb2R1bGUgJHttb2R1bGVOYW1lMn0gdGltZW91dGApKTsKICAgICAgICAoX2EgPSBzY3JpcHRMb2FkaW5nVGFza3Muc2hpZnQoKSkgPT0gbnVsbCA/IHZvaWQgMCA6IF9hKCk7CiAgICAgIH0sIGN0eDIuc2NyaXB0VGltZW91dCk7CiAgICAgIHNjcmlwdC5vbmxvYWQgPSAoKSA9PiB7CiAgICAgICAgdmFyIF9hOwogICAgICAgIGN0eDIubG9nZ2VyLmxvZygiW2FtZF0gc2NyaXB0IHJlc29sdmVkIiwgbG9hZGluZ01vZHVsZU5hbWUpOwogICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTsKICAgICAgICByZXNvbHZlMyhudWxsKTsKICAgICAgICBsb2FkaW5nTW9kdWxlTmFtZSA9ICIiOwogICAgICAgIChfYSA9IHNjcmlwdExvYWRpbmdUYXNrcy5zaGlmdCgpKSA9PSBudWxsID8gdm9pZCAwIDogX2EoKTsKICAgICAgfTsKICAgICAgc2NyaXB0Lm9uZXJyb3IgPSAoZXJyKSA9PiB7CiAgICAgICAgdmFyIF9hOwogICAgICAgIGN0eDIubG9nZ2VyLmxvZygiW2FtZF0gc2NyaXB0IHJlamVjdGVkIiwgbG9hZGluZ01vZHVsZU5hbWUpOwogICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTsKICAgICAgICByZWplY3QoZXJyKTsKICAgICAgICBsb2FkaW5nTW9kdWxlTmFtZSA9ICIiOwogICAgICAgIChfYSA9IHNjcmlwdExvYWRpbmdUYXNrcy5zaGlmdCgpKSA9PSBudWxsID8gdm9pZCAwIDogX2EoKTsKICAgICAgfTsKICAgICAgc2NyaXB0LmNyb3NzT3JpZ2luID0gImFub255bW91cyI7CiAgICAgIHNjcmlwdC5zcmMgPSB1cmw7CiAgICAgIHNjcmlwdC50eXBlID0gInRleHQvamF2YXNjcmlwdCI7CiAgICAgIGN0eDIubG9nZ2VyLmxvZygiW2FtZF0gc3RhcnQgbG9hZCBzY3JpcHQiLCBtb2R1bGVOYW1lMik7CiAgICAgIGxvYWRpbmdNb2R1bGVOYW1lID0gbW9kdWxlTmFtZTI7CiAgICAgIGRvbS5hcHBlbmRDaGlsZChzY3JpcHQpOwogICAgfSk7CiAgfTsKICBjdHgyLnNjcmlwdExvYWRlciA9IHsKICAgIGdldExvYWRpbmdNb2R1bGVOYW1lOiAoKSA9PiBsb2FkaW5nTW9kdWxlTmFtZSwKICAgIGxvYWRTY3JpcHQsCiAgICBzY3JpcHRMb2FkaW5nVGFza3MKICB9Owp9CnZhciBJRXZlbnRUeXBlcyA9IC8qIEBfX1BVUkVfXyAqLyAoKElFdmVudFR5cGVzMikgPT4gewogIElFdmVudFR5cGVzMlsiTW9kdWxlVXBkYXRlIl0gPSAibW9kdWxlLXVwZGF0ZSI7CiAgSUV2ZW50VHlwZXMyWyJMb2FkaW5nU2NyaXB0Il0gPSAibG9hZGluZy1zY3JpcHQiOwogIHJldHVybiBJRXZlbnRUeXBlczI7Cn0pKElFdmVudFR5cGVzIHx8IHt9KTsKZnVuY3Rpb24gYmluZERlZmluZVRvQ3R4KGN0eDIpIHsKICBmdW5jdGlvbiBkZWZpbmUobW9kdWxlTmFtZTIsIGRlcGVuZGVuY2llc18sIGZhY3RvcnkyKSB7CiAgICBpZiAodHlwZW9mIG1vZHVsZU5hbWUyID09PSAiZnVuY3Rpb24iKSB7CiAgICAgIGZhY3RvcnkyID0gbW9kdWxlTmFtZTI7CiAgICAgIGRlcGVuZGVuY2llc18gPSBbInJlcXVpcmUiLCAiZXhwb3J0cyIsICJtb2R1bGUiXTsKICAgICAgbW9kdWxlTmFtZTIgPSBjdHgyLnNjcmlwdExvYWRlci5nZXRMb2FkaW5nTW9kdWxlTmFtZSgpOwogICAgfQogICAgaWYgKEFycmF5LmlzQXJyYXkobW9kdWxlTmFtZTIpKSB7CiAgICAgIGZhY3RvcnkyID0gZGVwZW5kZW5jaWVzXzsKICAgICAgZGVwZW5kZW5jaWVzXyA9IG1vZHVsZU5hbWUyOwogICAgICBtb2R1bGVOYW1lMiA9IGN0eDIuc2NyaXB0TG9hZGVyLmdldExvYWRpbmdNb2R1bGVOYW1lKCk7CiAgICB9CiAgICBjdHgyLmxvZ2dlci5sb2coIlthbWRdIGRlZmluZSBtb2R1bGUiLCBtb2R1bGVOYW1lMiwgZGVwZW5kZW5jaWVzXyk7CiAgICBjb25zdCBtb2R1bGVQYXRoMiA9IGN0eDIucmVxdWlyZV8ucmVzb2x2ZShtb2R1bGVOYW1lMik7CiAgICBjb25zdCB7IGZhY3RvcmllczogZmFjdG9yaWVzMiwgY2FjaGU6IGNhY2hlMiwgZGVwZW5kZW5jaWVzOiBkZXBlbmRlbmNpZXMyIH0gPSBjdHgyLnJlcXVpcmVfOwogICAgaWYgKGZhY3RvcmllczIuaGFzKG1vZHVsZVBhdGgyKSkgewogICAgICBmYWN0b3JpZXMyLmRlbGV0ZShtb2R1bGVQYXRoMik7CiAgICB9CiAgICBpZiAoY2FjaGUyLmhhcyhtb2R1bGVQYXRoMikpIHsKICAgICAgY2FjaGUyLmRlbGV0ZShtb2R1bGVQYXRoMik7CiAgICB9CiAgICBpZiAoZGVwZW5kZW5jaWVzMi5oYXMobW9kdWxlUGF0aDIpKSB7CiAgICAgIGRlcGVuZGVuY2llczIuZGVsZXRlKG1vZHVsZVBhdGgyKTsKICAgIH0KICAgIGN0eDIuZXZlbnRTdWJzY3JpYmVNYW5hZ2VyLnRyaWdnZXIoSUV2ZW50VHlwZXMuTW9kdWxlVXBkYXRlLCBtb2R1bGVQYXRoMik7CiAgICBmYWN0b3JpZXMyLnNldChtb2R1bGVQYXRoMiwgZmFjdG9yeTIpOwogICAgZGVwZW5kZW5jaWVzMi5zZXQobW9kdWxlUGF0aDIsIGRlcGVuZGVuY2llc18pOwogICAgcmV0dXJuICgpID0+IHsKICAgICAgY3R4Mi5sb2dnZXIubG9nKCJbYW1kXSBtb2R1bGUgZGlzcG9zZSIsIG1vZHVsZU5hbWUyKTsKICAgICAgZmFjdG9yaWVzMi5kZWxldGUobW9kdWxlUGF0aDIpOwogICAgfTsKICB9CiAgY3R4Mi5kZWZpbmUgPSBPYmplY3QuYXNzaWduKGRlZmluZSwgewogICAgYW1kOiB7fQogIH0pOwp9CmZ1bmN0aW9uIGFzc2VydFBhdGgocGF0aCkgewogIGlmICh0eXBlb2YgcGF0aCAhPT0gInN0cmluZyIpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlBhdGggbXVzdCBiZSBhIHN0cmluZy4gUmVjZWl2ZWQgIiArIEpTT04uc3RyaW5naWZ5KHBhdGgpKTsKICB9Cn0KZnVuY3Rpb24gbm9ybWFsaXplU3RyaW5nUG9zaXgocGF0aCwgYWxsb3dBYm92ZVJvb3QpIHsKICB2YXIgcmVzID0gIiI7CiAgdmFyIGxhc3RTZWdtZW50TGVuZ3RoID0gMDsKICB2YXIgbGFzdFNsYXNoID0gLTE7CiAgdmFyIGRvdHMgPSAwOwogIHZhciBjb2RlOwogIGZvciAodmFyIGkgPSAwOyBpIDw9IHBhdGgubGVuZ3RoOyArK2kpIHsKICAgIGlmIChpIDwgcGF0aC5sZW5ndGgpCiAgICAgIGNvZGUgPSBwYXRoLmNoYXJDb2RlQXQoaSk7CiAgICBlbHNlIGlmIChjb2RlID09PSA0NykKICAgICAgYnJlYWs7CiAgICBlbHNlCiAgICAgIGNvZGUgPSA0NzsKICAgIGlmIChjb2RlID09PSA0NykgewogICAgICBpZiAobGFzdFNsYXNoID09PSBpIC0gMSB8fCBkb3RzID09PSAxKQogICAgICAgIDsKICAgICAgZWxzZSBpZiAobGFzdFNsYXNoICE9PSBpIC0gMSAmJiBkb3RzID09PSAyKSB7CiAgICAgICAgaWYgKHJlcy5sZW5ndGggPCAyIHx8IGxhc3RTZWdtZW50TGVuZ3RoICE9PSAyIHx8IHJlcy5jaGFyQ29kZUF0KHJlcy5sZW5ndGggLSAxKSAhPT0gNDYgfHwgcmVzLmNoYXJDb2RlQXQocmVzLmxlbmd0aCAtIDIpICE9PSA0NikgewogICAgICAgICAgaWYgKHJlcy5sZW5ndGggPiAyKSB7CiAgICAgICAgICAgIHZhciBsYXN0U2xhc2hJbmRleCA9IHJlcy5sYXN0SW5kZXhPZigiLyIpOwogICAgICAgICAgICBpZiAobGFzdFNsYXNoSW5kZXggIT09IHJlcy5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgICAgaWYgKGxhc3RTbGFzaEluZGV4ID09PSAtMSkgewogICAgICAgICAgICAgICAgcmVzID0gIiI7CiAgICAgICAgICAgICAgICBsYXN0U2VnbWVudExlbmd0aCA9IDA7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlcyA9IHJlcy5zbGljZSgwLCBsYXN0U2xhc2hJbmRleCk7CiAgICAgICAgICAgICAgICBsYXN0U2VnbWVudExlbmd0aCA9IHJlcy5sZW5ndGggLSAxIC0gcmVzLmxhc3RJbmRleE9mKCIvIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGxhc3RTbGFzaCA9IGk7CiAgICAgICAgICAgICAgZG90cyA9IDA7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAocmVzLmxlbmd0aCA9PT0gMiB8fCByZXMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgIHJlcyA9ICIiOwogICAgICAgICAgICBsYXN0U2VnbWVudExlbmd0aCA9IDA7CiAgICAgICAgICAgIGxhc3RTbGFzaCA9IGk7CiAgICAgICAgICAgIGRvdHMgPSAwOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGFsbG93QWJvdmVSb290KSB7CiAgICAgICAgICBpZiAocmVzLmxlbmd0aCA+IDApCiAgICAgICAgICAgIHJlcyArPSAiLy4uIjsKICAgICAgICAgIGVsc2UKICAgICAgICAgICAgcmVzID0gIi4uIjsKICAgICAgICAgIGxhc3RTZWdtZW50TGVuZ3RoID0gMjsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHJlcy5sZW5ndGggPiAwKQogICAgICAgICAgcmVzICs9ICIvIiArIHBhdGguc2xpY2UobGFzdFNsYXNoICsgMSwgaSk7CiAgICAgICAgZWxzZQogICAgICAgICAgcmVzID0gcGF0aC5zbGljZShsYXN0U2xhc2ggKyAxLCBpKTsKICAgICAgICBsYXN0U2VnbWVudExlbmd0aCA9IGkgLSBsYXN0U2xhc2ggLSAxOwogICAgICB9CiAgICAgIGxhc3RTbGFzaCA9IGk7CiAgICAgIGRvdHMgPSAwOwogICAgfSBlbHNlIGlmIChjb2RlID09PSA0NiAmJiBkb3RzICE9PSAtMSkgewogICAgICArK2RvdHM7CiAgICB9IGVsc2UgewogICAgICBkb3RzID0gLTE7CiAgICB9CiAgfQogIHJldHVybiByZXM7Cn0KZnVuY3Rpb24gX2Zvcm1hdChzZXAsIHBhdGhPYmplY3QpIHsKICB2YXIgZGlyID0gcGF0aE9iamVjdC5kaXIgfHwgcGF0aE9iamVjdC5yb290OwogIHZhciBiYXNlID0gcGF0aE9iamVjdC5iYXNlIHx8IChwYXRoT2JqZWN0Lm5hbWUgfHwgIiIpICsgKHBhdGhPYmplY3QuZXh0IHx8ICIiKTsKICBpZiAoIWRpcikgewogICAgcmV0dXJuIGJhc2U7CiAgfQogIGlmIChkaXIgPT09IHBhdGhPYmplY3Qucm9vdCkgewogICAgcmV0dXJuIGRpciArIGJhc2U7CiAgfQogIHJldHVybiBkaXIgKyBzZXAgKyBiYXNlOwp9CnZhciBwb3NpeCA9IHsKICAvLyBwYXRoLnJlc29sdmUoW2Zyb20gLi4uXSwgdG8pCiAgcmVzb2x2ZTogZnVuY3Rpb24gcmVzb2x2ZTIoKSB7CiAgICB2YXIgcmVzb2x2ZWRQYXRoID0gIiI7CiAgICB2YXIgcmVzb2x2ZWRBYnNvbHV0ZSA9IGZhbHNlOwogICAgdmFyIGN3ZDsKICAgIGZvciAodmFyIGkgPSBhcmd1bWVudHMubGVuZ3RoIC0gMTsgaSA+PSAtMSAmJiAhcmVzb2x2ZWRBYnNvbHV0ZTsgaS0tKSB7CiAgICAgIHZhciBwYXRoOwogICAgICBpZiAoaSA+PSAwKQogICAgICAgIHBhdGggPSBhcmd1bWVudHNbaV07CiAgICAgIGVsc2UgewogICAgICAgIGlmIChjd2QgPT09IHZvaWQgMCkKICAgICAgICAgIGN3ZCA9IHByb2Nlc3MuY3dkKCk7CiAgICAgICAgcGF0aCA9IGN3ZDsKICAgICAgfQogICAgICBhc3NlcnRQYXRoKHBhdGgpOwogICAgICBpZiAocGF0aC5sZW5ndGggPT09IDApIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICByZXNvbHZlZFBhdGggPSBwYXRoICsgIi8iICsgcmVzb2x2ZWRQYXRoOwogICAgICByZXNvbHZlZEFic29sdXRlID0gcGF0aC5jaGFyQ29kZUF0KDApID09PSA0NzsKICAgIH0KICAgIHJlc29sdmVkUGF0aCA9IG5vcm1hbGl6ZVN0cmluZ1Bvc2l4KHJlc29sdmVkUGF0aCwgIXJlc29sdmVkQWJzb2x1dGUpOwogICAgaWYgKHJlc29sdmVkQWJzb2x1dGUpIHsKICAgICAgaWYgKHJlc29sdmVkUGF0aC5sZW5ndGggPiAwKQogICAgICAgIHJldHVybiAiLyIgKyByZXNvbHZlZFBhdGg7CiAgICAgIGVsc2UKICAgICAgICByZXR1cm4gIi8iOwogICAgfSBlbHNlIGlmIChyZXNvbHZlZFBhdGgubGVuZ3RoID4gMCkgewogICAgICByZXR1cm4gcmVzb2x2ZWRQYXRoOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuICIuIjsKICAgIH0KICB9LAogIG5vcm1hbGl6ZTogZnVuY3Rpb24gbm9ybWFsaXplKHBhdGgpIHsKICAgIGFzc2VydFBhdGgocGF0aCk7CiAgICBpZiAocGF0aC5sZW5ndGggPT09IDApCiAgICAgIHJldHVybiAiLiI7CiAgICB2YXIgaXNBYnNvbHV0ZTIgPSBwYXRoLmNoYXJDb2RlQXQoMCkgPT09IDQ3OwogICAgdmFyIHRyYWlsaW5nU2VwYXJhdG9yID0gcGF0aC5jaGFyQ29kZUF0KHBhdGgubGVuZ3RoIC0gMSkgPT09IDQ3OwogICAgcGF0aCA9IG5vcm1hbGl6ZVN0cmluZ1Bvc2l4KHBhdGgsICFpc0Fic29sdXRlMik7CiAgICBpZiAocGF0aC5sZW5ndGggPT09IDAgJiYgIWlzQWJzb2x1dGUyKQogICAgICBwYXRoID0gIi4iOwogICAgaWYgKHBhdGgubGVuZ3RoID4gMCAmJiB0cmFpbGluZ1NlcGFyYXRvcikKICAgICAgcGF0aCArPSAiLyI7CiAgICBpZiAoaXNBYnNvbHV0ZTIpCiAgICAgIHJldHVybiAiLyIgKyBwYXRoOwogICAgcmV0dXJuIHBhdGg7CiAgfSwKICBpc0Fic29sdXRlOiBmdW5jdGlvbiBpc0Fic29sdXRlKHBhdGgpIHsKICAgIGFzc2VydFBhdGgocGF0aCk7CiAgICByZXR1cm4gcGF0aC5sZW5ndGggPiAwICYmIHBhdGguY2hhckNvZGVBdCgwKSA9PT0gNDc7CiAgfSwKICBqb2luOiBmdW5jdGlvbiBqb2luKCkgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApCiAgICAgIHJldHVybiAiLiI7CiAgICB2YXIgam9pbmVkOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyArK2kpIHsKICAgICAgdmFyIGFyZyA9IGFyZ3VtZW50c1tpXTsKICAgICAgYXNzZXJ0UGF0aChhcmcpOwogICAgICBpZiAoYXJnLmxlbmd0aCA+IDApIHsKICAgICAgICBpZiAoam9pbmVkID09PSB2b2lkIDApCiAgICAgICAgICBqb2luZWQgPSBhcmc7CiAgICAgICAgZWxzZQogICAgICAgICAgam9pbmVkICs9ICIvIiArIGFyZzsKICAgICAgfQogICAgfQogICAgaWYgKGpvaW5lZCA9PT0gdm9pZCAwKQogICAgICByZXR1cm4gIi4iOwogICAgcmV0dXJuIHBvc2l4Lm5vcm1hbGl6ZShqb2luZWQpOwogIH0sCiAgcmVsYXRpdmU6IGZ1bmN0aW9uIHJlbGF0aXZlKGZyb20sIHRvKSB7CiAgICBhc3NlcnRQYXRoKGZyb20pOwogICAgYXNzZXJ0UGF0aCh0byk7CiAgICBpZiAoZnJvbSA9PT0gdG8pCiAgICAgIHJldHVybiAiIjsKICAgIGZyb20gPSBwb3NpeC5yZXNvbHZlKGZyb20pOwogICAgdG8gPSBwb3NpeC5yZXNvbHZlKHRvKTsKICAgIGlmIChmcm9tID09PSB0bykKICAgICAgcmV0dXJuICIiOwogICAgdmFyIGZyb21TdGFydCA9IDE7CiAgICBmb3IgKDsgZnJvbVN0YXJ0IDwgZnJvbS5sZW5ndGg7ICsrZnJvbVN0YXJ0KSB7CiAgICAgIGlmIChmcm9tLmNoYXJDb2RlQXQoZnJvbVN0YXJ0KSAhPT0gNDcpCiAgICAgICAgYnJlYWs7CiAgICB9CiAgICB2YXIgZnJvbUVuZCA9IGZyb20ubGVuZ3RoOwogICAgdmFyIGZyb21MZW4gPSBmcm9tRW5kIC0gZnJvbVN0YXJ0OwogICAgdmFyIHRvU3RhcnQgPSAxOwogICAgZm9yICg7IHRvU3RhcnQgPCB0by5sZW5ndGg7ICsrdG9TdGFydCkgewogICAgICBpZiAodG8uY2hhckNvZGVBdCh0b1N0YXJ0KSAhPT0gNDcpCiAgICAgICAgYnJlYWs7CiAgICB9CiAgICB2YXIgdG9FbmQgPSB0by5sZW5ndGg7CiAgICB2YXIgdG9MZW4gPSB0b0VuZCAtIHRvU3RhcnQ7CiAgICB2YXIgbGVuZ3RoID0gZnJvbUxlbiA8IHRvTGVuID8gZnJvbUxlbiA6IHRvTGVuOwogICAgdmFyIGxhc3RDb21tb25TZXAgPSAtMTsKICAgIHZhciBpID0gMDsKICAgIGZvciAoOyBpIDw9IGxlbmd0aDsgKytpKSB7CiAgICAgIGlmIChpID09PSBsZW5ndGgpIHsKICAgICAgICBpZiAodG9MZW4gPiBsZW5ndGgpIHsKICAgICAgICAgIGlmICh0by5jaGFyQ29kZUF0KHRvU3RhcnQgKyBpKSA9PT0gNDcpIHsKICAgICAgICAgICAgcmV0dXJuIHRvLnNsaWNlKHRvU3RhcnQgKyBpICsgMSk7CiAgICAgICAgICB9IGVsc2UgaWYgKGkgPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuIHRvLnNsaWNlKHRvU3RhcnQgKyBpKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGZyb21MZW4gPiBsZW5ndGgpIHsKICAgICAgICAgIGlmIChmcm9tLmNoYXJDb2RlQXQoZnJvbVN0YXJ0ICsgaSkgPT09IDQ3KSB7CiAgICAgICAgICAgIGxhc3RDb21tb25TZXAgPSBpOwogICAgICAgICAgfSBlbHNlIGlmIChpID09PSAwKSB7CiAgICAgICAgICAgIGxhc3RDb21tb25TZXAgPSAwOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgfQogICAgICB2YXIgZnJvbUNvZGUgPSBmcm9tLmNoYXJDb2RlQXQoZnJvbVN0YXJ0ICsgaSk7CiAgICAgIHZhciB0b0NvZGUgPSB0by5jaGFyQ29kZUF0KHRvU3RhcnQgKyBpKTsKICAgICAgaWYgKGZyb21Db2RlICE9PSB0b0NvZGUpCiAgICAgICAgYnJlYWs7CiAgICAgIGVsc2UgaWYgKGZyb21Db2RlID09PSA0NykKICAgICAgICBsYXN0Q29tbW9uU2VwID0gaTsKICAgIH0KICAgIHZhciBvdXQgPSAiIjsKICAgIGZvciAoaSA9IGZyb21TdGFydCArIGxhc3RDb21tb25TZXAgKyAxOyBpIDw9IGZyb21FbmQ7ICsraSkgewogICAgICBpZiAoaSA9PT0gZnJvbUVuZCB8fCBmcm9tLmNoYXJDb2RlQXQoaSkgPT09IDQ3KSB7CiAgICAgICAgaWYgKG91dC5sZW5ndGggPT09IDApCiAgICAgICAgICBvdXQgKz0gIi4uIjsKICAgICAgICBlbHNlCiAgICAgICAgICBvdXQgKz0gIi8uLiI7CiAgICAgIH0KICAgIH0KICAgIGlmIChvdXQubGVuZ3RoID4gMCkKICAgICAgcmV0dXJuIG91dCArIHRvLnNsaWNlKHRvU3RhcnQgKyBsYXN0Q29tbW9uU2VwKTsKICAgIGVsc2UgewogICAgICB0b1N0YXJ0ICs9IGxhc3RDb21tb25TZXA7CiAgICAgIGlmICh0by5jaGFyQ29kZUF0KHRvU3RhcnQpID09PSA0NykKICAgICAgICArK3RvU3RhcnQ7CiAgICAgIHJldHVybiB0by5zbGljZSh0b1N0YXJ0KTsKICAgIH0KICB9LAogIF9tYWtlTG9uZzogZnVuY3Rpb24gX21ha2VMb25nKHBhdGgpIHsKICAgIHJldHVybiBwYXRoOwogIH0sCiAgZGlybmFtZTogZnVuY3Rpb24gZGlybmFtZShwYXRoKSB7CiAgICBhc3NlcnRQYXRoKHBhdGgpOwogICAgaWYgKHBhdGgubGVuZ3RoID09PSAwKQogICAgICByZXR1cm4gIi4iOwogICAgdmFyIGNvZGUgPSBwYXRoLmNoYXJDb2RlQXQoMCk7CiAgICB2YXIgaGFzUm9vdCA9IGNvZGUgPT09IDQ3OwogICAgdmFyIGVuZCA9IC0xOwogICAgdmFyIG1hdGNoZWRTbGFzaCA9IHRydWU7CiAgICBmb3IgKHZhciBpID0gcGF0aC5sZW5ndGggLSAxOyBpID49IDE7IC0taSkgewogICAgICBjb2RlID0gcGF0aC5jaGFyQ29kZUF0KGkpOwogICAgICBpZiAoY29kZSA9PT0gNDcpIHsKICAgICAgICBpZiAoIW1hdGNoZWRTbGFzaCkgewogICAgICAgICAgZW5kID0gaTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBtYXRjaGVkU2xhc2ggPSBmYWxzZTsKICAgICAgfQogICAgfQogICAgaWYgKGVuZCA9PT0gLTEpCiAgICAgIHJldHVybiBoYXNSb290ID8gIi8iIDogIi4iOwogICAgaWYgKGhhc1Jvb3QgJiYgZW5kID09PSAxKQogICAgICByZXR1cm4gIi8vIjsKICAgIHJldHVybiBwYXRoLnNsaWNlKDAsIGVuZCk7CiAgfSwKICBiYXNlbmFtZTogZnVuY3Rpb24gYmFzZW5hbWUocGF0aCwgZXh0KSB7CiAgICBpZiAoZXh0ICE9PSB2b2lkIDAgJiYgdHlwZW9mIGV4dCAhPT0gInN0cmluZyIpCiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJyJleHQiIGFyZ3VtZW50IG11c3QgYmUgYSBzdHJpbmcnKTsKICAgIGFzc2VydFBhdGgocGF0aCk7CiAgICB2YXIgc3RhcnQgPSAwOwogICAgdmFyIGVuZCA9IC0xOwogICAgdmFyIG1hdGNoZWRTbGFzaCA9IHRydWU7CiAgICB2YXIgaTsKICAgIGlmIChleHQgIT09IHZvaWQgMCAmJiBleHQubGVuZ3RoID4gMCAmJiBleHQubGVuZ3RoIDw9IHBhdGgubGVuZ3RoKSB7CiAgICAgIGlmIChleHQubGVuZ3RoID09PSBwYXRoLmxlbmd0aCAmJiBleHQgPT09IHBhdGgpCiAgICAgICAgcmV0dXJuICIiOwogICAgICB2YXIgZXh0SWR4ID0gZXh0Lmxlbmd0aCAtIDE7CiAgICAgIHZhciBmaXJzdE5vblNsYXNoRW5kID0gLTE7CiAgICAgIGZvciAoaSA9IHBhdGgubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHsKICAgICAgICB2YXIgY29kZSA9IHBhdGguY2hhckNvZGVBdChpKTsKICAgICAgICBpZiAoY29kZSA9PT0gNDcpIHsKICAgICAgICAgIGlmICghbWF0Y2hlZFNsYXNoKSB7CiAgICAgICAgICAgIHN0YXJ0ID0gaSArIDE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoZmlyc3ROb25TbGFzaEVuZCA9PT0gLTEpIHsKICAgICAgICAgICAgbWF0Y2hlZFNsYXNoID0gZmFsc2U7CiAgICAgICAgICAgIGZpcnN0Tm9uU2xhc2hFbmQgPSBpICsgMTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChleHRJZHggPj0gMCkgewogICAgICAgICAgICBpZiAoY29kZSA9PT0gZXh0LmNoYXJDb2RlQXQoZXh0SWR4KSkgewogICAgICAgICAgICAgIGlmICgtLWV4dElkeCA9PT0gLTEpIHsKICAgICAgICAgICAgICAgIGVuZCA9IGk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGV4dElkeCA9IC0xOwogICAgICAgICAgICAgIGVuZCA9IGZpcnN0Tm9uU2xhc2hFbmQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHN0YXJ0ID09PSBlbmQpCiAgICAgICAgZW5kID0gZmlyc3ROb25TbGFzaEVuZDsKICAgICAgZWxzZSBpZiAoZW5kID09PSAtMSkKICAgICAgICBlbmQgPSBwYXRoLmxlbmd0aDsKICAgICAgcmV0dXJuIHBhdGguc2xpY2Uoc3RhcnQsIGVuZCk7CiAgICB9IGVsc2UgewogICAgICBmb3IgKGkgPSBwYXRoLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICAgICAgaWYgKHBhdGguY2hhckNvZGVBdChpKSA9PT0gNDcpIHsKICAgICAgICAgIGlmICghbWF0Y2hlZFNsYXNoKSB7CiAgICAgICAgICAgIHN0YXJ0ID0gaSArIDE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoZW5kID09PSAtMSkgewogICAgICAgICAgbWF0Y2hlZFNsYXNoID0gZmFsc2U7CiAgICAgICAgICBlbmQgPSBpICsgMTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGVuZCA9PT0gLTEpCiAgICAgICAgcmV0dXJuICIiOwogICAgICByZXR1cm4gcGF0aC5zbGljZShzdGFydCwgZW5kKTsKICAgIH0KICB9LAogIGV4dG5hbWU6IGZ1bmN0aW9uIGV4dG5hbWUocGF0aCkgewogICAgYXNzZXJ0UGF0aChwYXRoKTsKICAgIHZhciBzdGFydERvdCA9IC0xOwogICAgdmFyIHN0YXJ0UGFydCA9IDA7CiAgICB2YXIgZW5kID0gLTE7CiAgICB2YXIgbWF0Y2hlZFNsYXNoID0gdHJ1ZTsKICAgIHZhciBwcmVEb3RTdGF0ZSA9IDA7CiAgICBmb3IgKHZhciBpID0gcGF0aC5sZW5ndGggLSAxOyBpID49IDA7IC0taSkgewogICAgICB2YXIgY29kZSA9IHBhdGguY2hhckNvZGVBdChpKTsKICAgICAgaWYgKGNvZGUgPT09IDQ3KSB7CiAgICAgICAgaWYgKCFtYXRjaGVkU2xhc2gpIHsKICAgICAgICAgIHN0YXJ0UGFydCA9IGkgKyAxOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChlbmQgPT09IC0xKSB7CiAgICAgICAgbWF0Y2hlZFNsYXNoID0gZmFsc2U7CiAgICAgICAgZW5kID0gaSArIDE7CiAgICAgIH0KICAgICAgaWYgKGNvZGUgPT09IDQ2KSB7CiAgICAgICAgaWYgKHN0YXJ0RG90ID09PSAtMSkKICAgICAgICAgIHN0YXJ0RG90ID0gaTsKICAgICAgICBlbHNlIGlmIChwcmVEb3RTdGF0ZSAhPT0gMSkKICAgICAgICAgIHByZURvdFN0YXRlID0gMTsKICAgICAgfSBlbHNlIGlmIChzdGFydERvdCAhPT0gLTEpIHsKICAgICAgICBwcmVEb3RTdGF0ZSA9IC0xOwogICAgICB9CiAgICB9CiAgICBpZiAoc3RhcnREb3QgPT09IC0xIHx8IGVuZCA9PT0gLTEgfHwgLy8gV2Ugc2F3IGEgbm9uLWRvdCBjaGFyYWN0ZXIgaW1tZWRpYXRlbHkgYmVmb3JlIHRoZSBkb3QKICAgIHByZURvdFN0YXRlID09PSAwIHx8IC8vIFRoZSAocmlnaHQtbW9zdCkgdHJpbW1lZCBwYXRoIGNvbXBvbmVudCBpcyBleGFjdGx5ICcuLicKICAgIHByZURvdFN0YXRlID09PSAxICYmIHN0YXJ0RG90ID09PSBlbmQgLSAxICYmIHN0YXJ0RG90ID09PSBzdGFydFBhcnQgKyAxKSB7CiAgICAgIHJldHVybiAiIjsKICAgIH0KICAgIHJldHVybiBwYXRoLnNsaWNlKHN0YXJ0RG90LCBlbmQpOwogIH0sCiAgZm9ybWF0OiBmdW5jdGlvbiBmb3JtYXQocGF0aE9iamVjdCkgewogICAgaWYgKHBhdGhPYmplY3QgPT09IG51bGwgfHwgdHlwZW9mIHBhdGhPYmplY3QgIT09ICJvYmplY3QiKSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1RoZSAicGF0aE9iamVjdCIgYXJndW1lbnQgbXVzdCBiZSBvZiB0eXBlIE9iamVjdC4gUmVjZWl2ZWQgdHlwZSAnICsgdHlwZW9mIHBhdGhPYmplY3QpOwogICAgfQogICAgcmV0dXJuIF9mb3JtYXQoIi8iLCBwYXRoT2JqZWN0KTsKICB9LAogIHBhcnNlOiBmdW5jdGlvbiBwYXJzZShwYXRoKSB7CiAgICBhc3NlcnRQYXRoKHBhdGgpOwogICAgdmFyIHJldCA9IHsgcm9vdDogIiIsIGRpcjogIiIsIGJhc2U6ICIiLCBleHQ6ICIiLCBuYW1lOiAiIiB9OwogICAgaWYgKHBhdGgubGVuZ3RoID09PSAwKQogICAgICByZXR1cm4gcmV0OwogICAgdmFyIGNvZGUgPSBwYXRoLmNoYXJDb2RlQXQoMCk7CiAgICB2YXIgaXNBYnNvbHV0ZTIgPSBjb2RlID09PSA0NzsKICAgIHZhciBzdGFydDsKICAgIGlmIChpc0Fic29sdXRlMikgewogICAgICByZXQucm9vdCA9ICIvIjsKICAgICAgc3RhcnQgPSAxOwogICAgfSBlbHNlIHsKICAgICAgc3RhcnQgPSAwOwogICAgfQogICAgdmFyIHN0YXJ0RG90ID0gLTE7CiAgICB2YXIgc3RhcnRQYXJ0ID0gMDsKICAgIHZhciBlbmQgPSAtMTsKICAgIHZhciBtYXRjaGVkU2xhc2ggPSB0cnVlOwogICAgdmFyIGkgPSBwYXRoLmxlbmd0aCAtIDE7CiAgICB2YXIgcHJlRG90U3RhdGUgPSAwOwogICAgZm9yICg7IGkgPj0gc3RhcnQ7IC0taSkgewogICAgICBjb2RlID0gcGF0aC5jaGFyQ29kZUF0KGkpOwogICAgICBpZiAoY29kZSA9PT0gNDcpIHsKICAgICAgICBpZiAoIW1hdGNoZWRTbGFzaCkgewogICAgICAgICAgc3RhcnRQYXJ0ID0gaSArIDE7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKGVuZCA9PT0gLTEpIHsKICAgICAgICBtYXRjaGVkU2xhc2ggPSBmYWxzZTsKICAgICAgICBlbmQgPSBpICsgMTsKICAgICAgfQogICAgICBpZiAoY29kZSA9PT0gNDYpIHsKICAgICAgICBpZiAoc3RhcnREb3QgPT09IC0xKQogICAgICAgICAgc3RhcnREb3QgPSBpOwogICAgICAgIGVsc2UgaWYgKHByZURvdFN0YXRlICE9PSAxKQogICAgICAgICAgcHJlRG90U3RhdGUgPSAxOwogICAgICB9IGVsc2UgaWYgKHN0YXJ0RG90ICE9PSAtMSkgewogICAgICAgIHByZURvdFN0YXRlID0gLTE7CiAgICAgIH0KICAgIH0KICAgIGlmIChzdGFydERvdCA9PT0gLTEgfHwgZW5kID09PSAtMSB8fCAvLyBXZSBzYXcgYSBub24tZG90IGNoYXJhY3RlciBpbW1lZGlhdGVseSBiZWZvcmUgdGhlIGRvdAogICAgcHJlRG90U3RhdGUgPT09IDAgfHwgLy8gVGhlIChyaWdodC1tb3N0KSB0cmltbWVkIHBhdGggY29tcG9uZW50IGlzIGV4YWN0bHkgJy4uJwogICAgcHJlRG90U3RhdGUgPT09IDEgJiYgc3RhcnREb3QgPT09IGVuZCAtIDEgJiYgc3RhcnREb3QgPT09IHN0YXJ0UGFydCArIDEpIHsKICAgICAgaWYgKGVuZCAhPT0gLTEpIHsKICAgICAgICBpZiAoc3RhcnRQYXJ0ID09PSAwICYmIGlzQWJzb2x1dGUyKQogICAgICAgICAgcmV0LmJhc2UgPSByZXQubmFtZSA9IHBhdGguc2xpY2UoMSwgZW5kKTsKICAgICAgICBlbHNlCiAgICAgICAgICByZXQuYmFzZSA9IHJldC5uYW1lID0gcGF0aC5zbGljZShzdGFydFBhcnQsIGVuZCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGlmIChzdGFydFBhcnQgPT09IDAgJiYgaXNBYnNvbHV0ZTIpIHsKICAgICAgICByZXQubmFtZSA9IHBhdGguc2xpY2UoMSwgc3RhcnREb3QpOwogICAgICAgIHJldC5iYXNlID0gcGF0aC5zbGljZSgxLCBlbmQpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldC5uYW1lID0gcGF0aC5zbGljZShzdGFydFBhcnQsIHN0YXJ0RG90KTsKICAgICAgICByZXQuYmFzZSA9IHBhdGguc2xpY2Uoc3RhcnRQYXJ0LCBlbmQpOwogICAgICB9CiAgICAgIHJldC5leHQgPSBwYXRoLnNsaWNlKHN0YXJ0RG90LCBlbmQpOwogICAgfQogICAgaWYgKHN0YXJ0UGFydCA+IDApCiAgICAgIHJldC5kaXIgPSBwYXRoLnNsaWNlKDAsIHN0YXJ0UGFydCAtIDEpOwogICAgZWxzZSBpZiAoaXNBYnNvbHV0ZTIpCiAgICAgIHJldC5kaXIgPSAiLyI7CiAgICByZXR1cm4gcmV0OwogIH0sCiAgc2VwOiAiLyIsCiAgZGVsaW1pdGVyOiAiOiIsCiAgd2luMzI6IG51bGwsCiAgcG9zaXg6IG51bGwKfTsKcG9zaXgucG9zaXggPSBwb3NpeDsKdmFyIHBhdGhCcm93c2VyaWZ5ID0gcG9zaXg7CmZ1bmN0aW9uIGJpbmRSZXF1aXJlVG9DdHgoY3R4KSB7CiAgY29uc3QgY2FjaGUgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpOwogIGNvbnN0IGZhY3RvcmllcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7CiAgY29uc3QgZGVwZW5kZW5jaWVzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTsKICBjb25zdCBtb2R1bGVSZXF1aXJpbmdUYXNrcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7CiAgY29uc3QgcGFyc2VNb2R1bGVOYW1lID0gZnVuY3Rpb24obW9kdWxlTmFtZTIpIHsKICAgIGNvbnN0IFssIG5hbWUsIHZlcnNpb24sIGZpbGVdID0gbW9kdWxlTmFtZTIubWF0Y2goLyheQD9bXi9AXSspKD86QChbXi9dKykpPyguKikvKSB8fCBbXTsKICAgIHJldHVybiBbbmFtZSwgdmVyc2lvbiwgZmlsZV07CiAgfTsKICBjb25zdCByZXNvbHZlID0gKG1vZHVsZU5hbWUyLCBfX2ZpbGVwYXRoKSA9PiB7CiAgICBpZiAoWyJyZXF1aXJlIiwgIm1vZHVsZSIsICJleHBvcnRzIl0uaW5jbHVkZXMobW9kdWxlTmFtZTIpKSB7CiAgICAgIHJldHVybiBtb2R1bGVOYW1lMjsKICAgIH0KICAgIGlmIChwYXRoQnJvd3NlcmlmeS5pc0Fic29sdXRlKG1vZHVsZU5hbWUyKSkgewogICAgICByZXR1cm4gbW9kdWxlTmFtZTI7CiAgICB9CiAgICBpZiAobW9kdWxlTmFtZTIuc3RhcnRzV2l0aCgiLiIpKSB7CiAgICAgIGlmICghX19maWxlcGF0aCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcihgW2FtZF0gY2FuJ3Qgbm90IHJlc29sdmUgcmVsYXRpdmUgcGF0aCAke21vZHVsZU5hbWUyfSB3aXRob3V0IF9fZGlybmFtZWApOwogICAgICB9CiAgICAgIHJldHVybiBwYXRoQnJvd3NlcmlmeS5yZXNvbHZlKHBhdGhCcm93c2VyaWZ5LmRpcm5hbWUoX19maWxlcGF0aCksIG1vZHVsZU5hbWUyKTsKICAgIH0KICAgIGNvbnN0IFttb2R1bGVQYXRoMl0gPSBwYXJzZU1vZHVsZU5hbWUobW9kdWxlTmFtZTIpOwogICAgcmV0dXJuIHBhdGhCcm93c2VyaWZ5LnJlc29sdmUoY3R4LnJvb3QsICJub2RlX21vZHVsZXMiLCBtb2R1bGVQYXRoMik7CiAgfTsKICBjb25zdCByZXNvbHZlRGVwcyA9IGFzeW5jIChfcGFja2FnZU5hbWUsIF92ZXJzaW9uLCBfZmlsZSkgPT4gewogICAgY29uc3QgcGFyYW1zID0gewogICAgICBwYWNrYWdlTmFtZTogX3BhY2thZ2VOYW1lLAogICAgICB2ZXJzaW9uOiBfdmVyc2lvbiwKICAgICAgZmlsZTogX2ZpbGUKICAgIH07CiAgICBjb25zdCByZXMgPSBhd2FpdCBjdHgucGx1Z2luUmVkdWNlKAogICAgICBhc3luYyAocHJlVmFsdWUsIHBsdWdpbikgPT4gewogICAgICAgIGNvbnN0IHJlczIgPSBhd2FpdCBwbHVnaW4ucmVzb2x2ZU1vZHVsZVVybChwcmVWYWx1ZSk7CiAgICAgICAgaWYgKHR5cGVvZiByZXMyID09PSAic3RyaW5nIikgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcmVzdWx0OiByZXMyLAogICAgICAgICAgICBicmVhazogdHJ1ZQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHsgcmVzdWx0OiByZXMyIH07CiAgICAgIH0sCiAgICAgIHBhcmFtcwogICAgKTsKICAgIHJldHVybiByZXM7CiAgfTsKICBjb25zdCBtb2R1bGVGYWN0b3J5ID0gYXN5bmMgKG1vZHVsZU5hbWUsIF90aGlzKSA9PiB7CiAgICBjb25zdCBtb2R1bGVQYXRoID0gcmVzb2x2ZShtb2R1bGVOYW1lLCBfdGhpcy5fX2Rpcm5hbWUpOwogICAgaWYgKG1vZHVsZVJlcXVpcmluZ1Rhc2tzLmhhcyhtb2R1bGVQYXRoKSkgewogICAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUyMiwgcmVqZWN0KSA9PiB7CiAgICAgICAgY29uc3QgdGFza3MgPSBtb2R1bGVSZXF1aXJpbmdUYXNrcy5nZXQobW9kdWxlUGF0aCk7CiAgICAgICAgdGFza3MucHVzaChbcmVzb2x2ZTIyLCByZWplY3RdKTsKICAgICAgICBjdHgubG9nZ2VyLmxvZyhgW2FtZF0gcmVxdWlyZSAke21vZHVsZU5hbWV9LCBhbHJlYWR5IGhhcyB0YXNrIHJlcXVpcmluZywgd2FpdGluZyB0YXNrczogJHt0YXNrcy5sZW5ndGh9LmApOwogICAgICB9KTsKICAgIH0KICAgIGN0eC5sb2dnZXIubG9nKCJbYW1kXSBzdGFydCByZXF1aXJlIiwgbW9kdWxlUGF0aCk7CiAgICBtb2R1bGVSZXF1aXJpbmdUYXNrcy5zZXQobW9kdWxlUGF0aCwgW10pOwogICAgY29uc3QgY2xlYXJBbGxUYXNrcyA9IChlcnIsIG1vZHVsZV8yKSA9PiB7CiAgICAgIGNvbnN0IHRhc2tzID0gbW9kdWxlUmVxdWlyaW5nVGFza3MuZ2V0KG1vZHVsZVBhdGgpOwogICAgICBpZiAodGFza3MgPT0gbnVsbCA/IHZvaWQgMCA6IHRhc2tzLmxlbmd0aCkgewogICAgICAgIHRhc2tzLmZvckVhY2goKFtyZXNvbHZlMjIsIHJlamVjdF0sIGluZGV4KSA9PiB7CiAgICAgICAgICBjdHgubG9nZ2VyLmxvZygiW2FtZF0gcmVzb2x2ZSBpdGVtIiwgaW5kZXgsIG1vZHVsZU5hbWUpOwogICAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICByZWplY3QoZXJyKTsKICAgICAgICAgIH0KICAgICAgICAgIHJlc29sdmUyMihtb2R1bGVfMik7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgbW9kdWxlUmVxdWlyaW5nVGFza3MuZGVsZXRlKG1vZHVsZVBhdGgpOwogICAgICBpZiAoZXJyKSB7CiAgICAgICAgdGhyb3cgZXJyOwogICAgICB9CiAgICAgIHJldHVybiBtb2R1bGVfMjsKICAgIH07CiAgICBpZiAoY2FjaGUuaGFzKG1vZHVsZVBhdGgpKSB7CiAgICAgIGN0eC5sb2dnZXIubG9nKGBbYW1kXSByZXF1aXJlICR7bW9kdWxlTmFtZX0sIHJlc29sdmVkIGZyb20gY2FjaGVgKTsKICAgICAgcmV0dXJuIGNsZWFyQWxsVGFza3Modm9pZCAwLCBjYWNoZS5nZXQobW9kdWxlUGF0aCkpOwogICAgfQogICAgY29uc3QgcmVxdWlyZV8gPSBnZXRSZXF1aXJlRnVuYyh7IF9fZGlybmFtZTogbW9kdWxlUGF0aCB9KTsKICAgIGxldCBmYWN0b3J5ID0gZmFjdG9yaWVzLmdldChtb2R1bGVQYXRoKTsKICAgIGlmICghZmFjdG9yeSkgewogICAgICBpZiAoIW1vZHVsZU5hbWUuc3RhcnRzV2l0aCgiLiIpICYmICFtb2R1bGVOYW1lLnN0YXJ0c1dpdGgoIl9fIikgJiYgIXBhdGhCcm93c2VyaWZ5LmlzQWJzb2x1dGUobW9kdWxlTmFtZSkpIHsKICAgICAgICBjb25zdCBbbmFtZSwgdmVyc2lvbiwgZmlsZV0gPSBwYXJzZU1vZHVsZU5hbWUobW9kdWxlTmFtZSk7CiAgICAgICAgY29uc3Qgc2NyaXB0VXJsID0gYXdhaXQgcmVxdWlyZV8ucmVzb2x2ZURlcHMobmFtZSwgdmVyc2lvbiwgZmlsZSk7CiAgICAgICAgY3R4LmV2ZW50U3Vic2NyaWJlTWFuYWdlci50cmlnZ2VyKElFdmVudFR5cGVzLkxvYWRpbmdTY3JpcHQsIG1vZHVsZU5hbWUsIHNjcmlwdFVybCk7CiAgICAgICAgaWYgKHR5cGVvZiBzY3JpcHRVcmwgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICBhd2FpdCBjdHguc2NyaXB0TG9hZGVyLmxvYWRTY3JpcHQoY3R4LnNjcmlwdENvbnRhaW5lckRvbSwgc2NyaXB0VXJsLCBtb2R1bGVOYW1lKTsKICAgICAgICAgIGZhY3RvcnkgPSBmYWN0b3JpZXMuZ2V0KG1vZHVsZVBhdGgpOwogICAgICAgICAgY3R4LmxvZ2dlci5sb2coIlthbWRdIHNjcmlwdCBsb2FkZWQiLCBmYWN0b3J5LCBtb2R1bGVQYXRoKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKCFmYWN0b3J5KSB7CiAgICAgICAgY29uc3QgZXJyID0gbmV3IEVycm9yKGBbYW1kXSBtb2R1bGUgZXJyb3I6ICR7bW9kdWxlUGF0aH0gZG9lcyBub3QgZXhpc3QuYCk7CiAgICAgICAgcmV0dXJuIGNsZWFyQWxsVGFza3MoZXJyKTsKICAgICAgfQogICAgfQogICAgbGV0IGRlcE1vZHVsZU5hbWVzID0gZGVwZW5kZW5jaWVzLmdldChtb2R1bGVQYXRoKTsKICAgIGlmICh0eXBlb2YgZmFjdG9yeSA9PT0gInN0cmluZyIpIHsKICAgICAgY29uc3QgeyBkZXBzOiBfZGVwTW9kdWxlTmFtZXMsIGZhY3Rvcnk6IGZhY3RvcnlfIH0gPSBhd2FpdCBjdHgucGx1Z2luUmVkdWNlKGFzeW5jIChwcmVWYWx1ZSwgcGx1Z2luKSA9PiB7CiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGx1Z2luLmJlZm9yZU1vZHVsZUdlbmVyYXRlKF90aGlzLCBwcmVWYWx1ZSk7CiAgICAgICAgcmV0dXJuIHsgcmVzdWx0OiB7IC4uLnJlc3VsdCwgbmFtZTogbW9kdWxlTmFtZSB9IH07CiAgICAgIH0sIHsgbmFtZTogbW9kdWxlTmFtZSwgZGVwczogZGVwTW9kdWxlTmFtZXMsIGZhY3RvcnkgfSk7CiAgICAgIGZhY3RvcnkgPSBmYWN0b3J5XzsKICAgICAgZGVwTW9kdWxlTmFtZXMgPSBfZGVwTW9kdWxlTmFtZXM7CiAgICB9CiAgICBjb25zdCBfZXhwb3J0cyA9IHt9OwogICAgY29uc3QgY29tbW9uanMgPSB7CiAgICAgIHJlcXVpcmU6IHJlcXVpcmVfLAogICAgICBtb2R1bGU6IHsgZXhwb3J0czogX2V4cG9ydHMgfSwKICAgICAgZXhwb3J0czogX2V4cG9ydHMKICAgIH07CiAgICBsZXQgZGVwcyA9IFtdOwogICAgaWYgKGRlcE1vZHVsZU5hbWVzID09IG51bGwgPyB2b2lkIDAgOiBkZXBNb2R1bGVOYW1lcy5sZW5ndGgpIHsKICAgICAgZGVwcyA9IGF3YWl0IFByb21pc2UuYWxsKGRlcE1vZHVsZU5hbWVzLm1hcCgoZGVwTmFtZSkgPT4gewogICAgICAgIGlmIChjb21tb25qc1tkZXBOYW1lXSkKICAgICAgICAgIHJldHVybiBjb21tb25qc1tkZXBOYW1lXTsKICAgICAgICByZXR1cm4gcmVxdWlyZV8oZGVwTmFtZSk7CiAgICAgIH0pKTsKICAgIH0KICAgIHRyeSB7CiAgICAgIGxldCBleHBvcnRzUmV0dXJuOwogICAgICBpZiAodHlwZW9mIGZhY3RvcnkgPT09ICJzdHJpbmciKSB7CiAgICAgICAgZXhwb3J0c1JldHVybiA9IGF3YWl0IGV2YWwoZmFjdG9yeSkoLi4uZGVwcyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZXhwb3J0c1JldHVybiA9IGF3YWl0IGZhY3RvcnkoLi4uZGVwcyk7CiAgICAgIH0KICAgICAgY29uc3QgbW9kdWxlXyA9ICgoKSA9PiB7CiAgICAgICAgaWYgKE9iamVjdC5rZXlzKGNvbW1vbmpzLm1vZHVsZS5leHBvcnRzKS5sZW5ndGggfHwgdHlwZW9mIGNvbW1vbmpzLm1vZHVsZS5leHBvcnRzICE9PSAib2JqZWN0IikgewogICAgICAgICAgcmV0dXJuIGNvbW1vbmpzLm1vZHVsZS5leHBvcnRzOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZXhwb3J0c1JldHVybjsKICAgICAgfSkoKTsKICAgICAgY2FjaGUuc2V0KG1vZHVsZVBhdGgsIG1vZHVsZV8pOwogICAgICBjdHgubG9nZ2VyLmxvZygiW2FtZF0gcmVzb2x2ZSBtb2R1bGUgdGFza3MgaGVhZCIsIG1vZHVsZVBhdGgsIG1vZHVsZV8pOwogICAgICByZXR1cm4gY2xlYXJBbGxUYXNrcyh2b2lkIDAsIG1vZHVsZV8pOwogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgIHJldHVybiBjbGVhckFsbFRhc2tzKGVyciwgdm9pZCAwKTsKICAgIH0KICB9OwogIGNvbnN0IHJlcXVpcmVQcm90byA9IGFzeW5jIChfdGhpczIsIC4uLmFyZ3MpID0+IHsKICAgIGNvbnN0IFttb2R1bGVOYW1lc18sIGNiXSA9IGFyZ3M7CiAgICBjb25zdCBtb2R1bGVOYW1lcyA9IGF3YWl0IGN0eC5wbHVnaW5SZWR1Y2UoYXN5bmMgKHByZVZhbHVlLCBwbHVnaW4pID0+IHsKICAgICAgcmV0dXJuIHsKICAgICAgICByZXN1bHQ6IGF3YWl0IHBsdWdpbi5yZXF1aXJlKF90aGlzMiwgcHJlVmFsdWUpCiAgICAgIH07CiAgICB9LCBtb2R1bGVOYW1lc18pOwogICAgbGV0IG1vZHVsZXM7CiAgICBpZiAoQXJyYXkuaXNBcnJheShtb2R1bGVOYW1lcykpIHsKICAgICAgbW9kdWxlcyA9IGF3YWl0IFByb21pc2UuYWxsKG1vZHVsZU5hbWVzLm1hcCgobmFtZSkgPT4gbW9kdWxlRmFjdG9yeShuYW1lLCBfdGhpczIpKSk7CiAgICB9IGVsc2UgewogICAgICBtb2R1bGVzID0gYXdhaXQgbW9kdWxlRmFjdG9yeShtb2R1bGVOYW1lcywgX3RoaXMyKTsKICAgIH0KICAgIGNiID09IG51bGwgPyB2b2lkIDAgOiBjYihtb2R1bGVzKTsKICAgIHJldHVybiBtb2R1bGVzOwogIH07CiAgY29uc3QgZ2V0UmVxdWlyZUZ1bmMgPSAoX3RoaXMyKSA9PiB7CiAgICB2YXIgX2E7CiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihyZXF1aXJlUHJvdG8uYmluZChudWxsLCBfdGhpczIpLCB7CiAgICAgIGNhY2hlLAogICAgICBmYWN0b3JpZXMsCiAgICAgIHJlc29sdmUsCiAgICAgIGRlcGVuZGVuY2llcywKICAgICAgbW9kdWxlUmVxdWlyaW5nVGFza3MsCiAgICAgIC8vIOi/meS5iOWPluWAvOaYr+S4uuS6huWPr+S7peS7juWklumDqOimhuebluaOiSByZXNvbHZlRGVwcyDnmoTpgLvovpEKICAgICAgcmVzb2x2ZURlcHM6ICgoX2EgPSBjdHggPT0gbnVsbCA/IHZvaWQgMCA6IGN0eC5yZXF1aXJlXykgPT0gbnVsbCA/IHZvaWQgMCA6IF9hLnJlc29sdmVEZXBzKSB8fCByZXNvbHZlRGVwcwogICAgfSk7CiAgfTsKICBjdHgucmVxdWlyZV8gPSBnZXRSZXF1aXJlRnVuYyh7IF9fZGlybmFtZTogY3R4LnJvb3QgfSk7Cn0KY29uc3QgY3JlYXRlRXZlbnRTdWJzY3JpYmVNYW5hZ2VyID0gKCkgPT4gewogIGNvbnN0IGV2ZW50c0hhbmRsZXJzTWFwID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTsKICBjb25zdCB0cmlnZ2VyID0gKGtleSwgLi4ucGFyYW1zKSA9PiB7CiAgICBjb25zdCBoYW5kbGVycyA9IGV2ZW50c0hhbmRsZXJzTWFwLmdldChrZXkpOwogICAgaWYgKGhhbmRsZXJzKSB7CiAgICAgIGNvbnN0IGRyb3BzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTsKICAgICAgaGFuZGxlcnMuZm9yRWFjaCgoaGFuZGxlciwgaW5kZXgpID0+IHsKICAgICAgICBpZiAoaGFuZGxlci5maWx0ZXIgJiYgIWhhbmRsZXIuZmlsdGVyKC4uLnBhcmFtcykpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaGFuZGxlciguLi5wYXJhbXMpOwogICAgICAgIGlmIChoYW5kbGVyLm9uY2UpIHsKICAgICAgICAgIGRyb3BzLnNldChpbmRleCwgdHJ1ZSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgZXZlbnRzSGFuZGxlcnNNYXAuc2V0KGtleSwgaGFuZGxlcnMuZmlsdGVyKChfLCBpbmRleCkgPT4gIWRyb3BzLmdldChpbmRleCkpKTsKICAgIH0KICB9OwogIGNvbnN0IGxpc3RlbiA9IChrZXksIGNiLCBmaWx0ZXIpID0+IHsKICAgIHZhciBfYSwgX2I7CiAgICBpZiAoIWV2ZW50c0hhbmRsZXJzTWFwLmhhcyhrZXkpKSB7CiAgICAgIGV2ZW50c0hhbmRsZXJzTWFwLnNldChrZXksIFtdKTsKICAgIH0KICAgIChfYiA9IChfYSA9IGV2ZW50c0hhbmRsZXJzTWFwLmdldChrZXkpKSA9PSBudWxsID8gdm9pZCAwIDogX2EucHVzaCkgPT0gbnVsbCA/IHZvaWQgMCA6IF9iLmNhbGwoX2EsIE9iamVjdC5hc3NpZ24oY2IsIHsKICAgICAgZmlsdGVyCiAgICB9KSk7CiAgICByZXR1cm4gKCkgPT4gewogICAgICB2YXIgX2EyOwogICAgICAoX2EyID0gZXZlbnRzSGFuZGxlcnNNYXAuZ2V0KGtleSkpID09IG51bGwgPyB2b2lkIDAgOiBfYTIuZmlsdGVyKChoYW5kbGVyKSA9PiBoYW5kbGVyICE9PSBjYik7CiAgICB9OwogIH07CiAgY29uc3Qgb25jZSA9IChrZXksIGNiLCBmaWx0ZXIsIG9uVGltZW91dCwgdGltZW91dCA9IC0xKSA9PiB7CiAgICB2YXIgX2EsIF9iOwogICAgaWYgKCFldmVudHNIYW5kbGVyc01hcC5oYXMoa2V5KSkgewogICAgICBldmVudHNIYW5kbGVyc01hcC5zZXQoa2V5LCBbXSk7CiAgICB9CiAgICBjb25zdCBkaXNwb3NlID0gKCkgPT4gewogICAgICB2YXIgX2EyOwogICAgICAoX2EyID0gZXZlbnRzSGFuZGxlcnNNYXAuZ2V0KGtleSkpID09IG51bGwgPyB2b2lkIDAgOiBfYTIuZmlsdGVyKChoYW5kbGVyKSA9PiBoYW5kbGVyICE9PSBjYik7CiAgICB9OwogICAgbGV0IF90aW1lb3V0OwogICAgaWYgKHRpbWVvdXQgIT09IC0xKSB7CiAgICAgIF90aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgZGlzcG9zZSgpOwogICAgICAgIG9uVGltZW91dCA9PSBudWxsID8gdm9pZCAwIDogb25UaW1lb3V0KCk7CiAgICAgIH0sIHRpbWVvdXQpOwogICAgfQogICAgKF9iID0gKF9hID0gZXZlbnRzSGFuZGxlcnNNYXAuZ2V0KGtleSkpID09IG51bGwgPyB2b2lkIDAgOiBfYS5wdXNoKSA9PSBudWxsID8gdm9pZCAwIDogX2IuY2FsbChfYSwgT2JqZWN0LmFzc2lnbigoLi4uYXJncykgPT4gewogICAgICBpZiAoX3RpbWVvdXQpCiAgICAgICAgY2xlYXJUaW1lb3V0KF90aW1lb3V0KTsKICAgICAgY2IoLi4uYXJncyk7CiAgICB9LCB7CiAgICAgIG9uY2U6IHRydWUsCiAgICAgIGZpbHRlcgogICAgfSkpOwogICAgcmV0dXJuIGRpc3Bvc2U7CiAgfTsKICByZXR1cm4geyB0cmlnZ2VyLCBsaXN0ZW4sIG9uY2UgfTsKfTsKZnVuY3Rpb24gY3JlYXRlQW1kTWFuYWdlcihyb290ID0gIi8iLCBzY3JpcHRUaW1lb3V0ID0gMWU0LCBsb2dnZXIyID0gY29uc29sZSkgewogIGNvbnN0IGN0eDIgPSB7fTsKICBjdHgyLmV2ZW50U3Vic2NyaWJlTWFuYWdlciA9IGNyZWF0ZUV2ZW50U3Vic2NyaWJlTWFuYWdlcigpOwogIGN0eDIucm9vdCA9IHJvb3Q7CiAgY3R4Mi5zY3JpcHRUaW1lb3V0ID0gc2NyaXB0VGltZW91dDsKICBjdHgyLnNjcmlwdENvbnRhaW5lckRvbSA9IGRvY3VtZW50LmJvZHk7CiAgY3R4Mi5sb2dnZXIgPSBsb2dnZXIyOwogIGN0eDIucGx1Z2lucyA9IFtdOwogIGN0eDIucGx1Z2luUmVkdWNlID0gYXN5bmMgKHJlZHVjZXIsIGluaXRWYWx1ZSkgPT4gewogICAgbGV0IHJlc3VsdCA9IGluaXRWYWx1ZTsKICAgIGZvciAoY29uc3QgcGx1Z2luIG9mIGN0eDIucGx1Z2lucykgewogICAgICBjb25zdCB7IHJlc3VsdDogcmVzLCBicmVhazogYnJlYWtfIH0gPSBhd2FpdCByZWR1Y2VyKHJlc3VsdCwgcGx1Z2luKTsKICAgICAgaWYgKGJyZWFrXykgewogICAgICAgIHJldHVybiByZXM7CiAgICAgIH0KICAgICAgcmVzdWx0ID0gcmVzOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9OwogIGJpbmRSZXF1aXJlVG9DdHgoY3R4Mik7CiAgYmluZERlZmluZVRvQ3R4KGN0eDIpOwogIGJpbmRTY3JpcHRMb2FkZXJUb0N0eChjdHgyKTsKICBmdW5jdGlvbiBpbXBvcnRHbG9iYWxPYmplY3RTY3JpcHQodGFyZ2V0LCB1cmwsIG5hbWUpIHsKICAgIHJldHVybiBhc3luYyAoX3JlcXVpcmUpID0+IHsKICAgICAgYXdhaXQgY3R4Mi5zY3JpcHRMb2FkZXIubG9hZFNjcmlwdCh0YXJnZXQsIHVybCk7CiAgICAgIHJldHVybiB7CiAgICAgICAgImRlZmF1bHQiOiBSZWZsZWN0LmdldCh3aW5kb3csIG5hbWUpLAogICAgICAgIC4uLlJlZmxlY3QuZ2V0KHdpbmRvdywgbmFtZSkKICAgICAgfTsKICAgIH07CiAgfQogIGNvbnN0IG1vZHVsZV8yID0gewogICAgcmVxdWlyZV86IGN0eDIucmVxdWlyZV8sCiAgICBkZWZpbmU6IGN0eDIuZGVmaW5lLAogICAgX2ltcG9ydDogaW1wb3J0R2xvYmFsT2JqZWN0U2NyaXB0LmJpbmQobnVsbCwgY3R4Mi5zY3JpcHRDb250YWluZXJEb20pLAogICAgc2V0OiAoeyB0YXJnZXQsIHJlc29sdmU6IF9yZXNvbHZlIH0pID0+IHsKICAgICAgaWYgKF9yZXNvbHZlKSB7CiAgICAgICAgY3R4Mi5yZXF1aXJlXy5yZXNvbHZlRGVwcyA9IF9yZXNvbHZlOwogICAgICB9CiAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICBjdHgyLnNjcmlwdENvbnRhaW5lckRvbSA9IHRhcmdldDsKICAgICAgfQogICAgfSwKICAgIG9uTW9kdWxlVXBkYXRlKHRhcmdldHMsIGNiKSB7CiAgICAgIHJldHVybiBjdHgyLmV2ZW50U3Vic2NyaWJlTWFuYWdlci5saXN0ZW4oSUV2ZW50VHlwZXMuTW9kdWxlVXBkYXRlLCAobW9kdWxlTmFtZTIpID0+IHsKICAgICAgICBpZiAoIXRhcmdldHMgfHwgdGFyZ2V0cy5pbmNsdWRlcyhtb2R1bGVOYW1lMikpIHsKICAgICAgICAgIGNiKFttb2R1bGVOYW1lMl0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgb25Nb2R1bGVMb2FkaW5nKGNiKSB7CiAgICAgIHJldHVybiBjdHgyLmV2ZW50U3Vic2NyaWJlTWFuYWdlci5saXN0ZW4oSUV2ZW50VHlwZXMuTG9hZGluZ1NjcmlwdCwgKG1vZHVsZU5hbWUyLCB1cmwpID0+IHsKICAgICAgICBjYihtb2R1bGVOYW1lMiwgdXJsKTsKICAgICAgfSk7CiAgICB9LAogICAgbW91bnRUb0dsb2JhbChnbG9iYWxfID0gd2luZG93KSB7CiAgICAgIGNvbnN0IGN1cnJlbnREZWZpbmUgPSBSZWZsZWN0LmdldChnbG9iYWxfLCAiZGVmaW5lIik7CiAgICAgIGNvbnN0IGN1cnJlbnRSZXF1aXJlID0gUmVmbGVjdC5nZXQoZ2xvYmFsXywgInJlcXVpcmUiKTsKICAgICAgUmVmbGVjdC5zZXQoZ2xvYmFsXywgImRlZmluZSIsIGN0eDIuZGVmaW5lKTsKICAgICAgUmVmbGVjdC5zZXQoZ2xvYmFsXywgInJlcXVpcmUiLCBjdHgyLnJlcXVpcmVfKTsKICAgICAgcmV0dXJuICgpID0+IHsKICAgICAgICBSZWZsZWN0LnNldChnbG9iYWxfLCAiZGVmaW5lIiwgY3VycmVudERlZmluZSk7CiAgICAgICAgUmVmbGVjdC5zZXQoZ2xvYmFsXywgInJlcXVpcmUiLCBjdXJyZW50UmVxdWlyZSk7CiAgICAgIH07CiAgICB9LAogICAgc2V0UGx1Z2lucyhwbHVnaW5zKSB7CiAgICAgIGN0eDIucGx1Z2lucyA9IHBsdWdpbnM7CiAgICB9CiAgfTsKICBjdHgyLmRlZmluZSgibW9kdWxlLW1hbmFnZXIiLCBbXSwgYXN5bmMgKCkgPT4gKHsKICAgIGRlZmF1bHQ6IG1vZHVsZV8yLAogICAgLi4ubW9kdWxlXzIKICB9KSk7CiAgcmV0dXJuIG1vZHVsZV8yOwp9CmNyZWF0ZUFtZE1hbmFnZXIoKTsKY29uc3QgRGVtb1NlcnZpY2VOYW1lID0gImRlbW8tc2VydmljZSI7CmNvbnN0IE5PVElGSUNBVElPTl9TRVJWSUNFID0gImlmcmFtZS1ub3RpZmljYXRpb24tc2VydmljZSI7CmNvbnN0IGlmcmFtZVJlYWR5ID0gYXN5bmMgKCkgPT4gewogIHJlZ2lzdGVyUHJveHkoTk9USUZJQ0FUSU9OX1NFUlZJQ0UsIHsKICAgIGlmcmFtZVJlYWR5OiBhc3luYyAoKSA9PiB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogIH0pOwogIGNvbnN0IHBhcmVudCA9IHdpbmRvdy50b3AgfHwgd2luZG93LnBhcmVudCB8fCB3aW5kb3cub3BlbmVyOwogIGlmICghcGFyZW50KQogICAgcmV0dXJuOwogIHJldHVybiBjYWxsUHJveHkoewogICAgd2luOiBwYXJlbnQsCiAgICBzZXJ2aWNlSWQ6IE5PVElGSUNBVElPTl9TRVJWSUNFLAogICAgbWV0aG9kOiAiaWZyYW1lUmVhZHkiLAogICAgcGF5bG9hZDogW10KICB9KTsKfTsKY29uc3QgaWZyYW1lTG9hZGluZ01vZHVsZSA9IGFzeW5jIChtb2R1bGVOYW1lMiwgZXh0cmFJbmZvKSA9PiB7CiAgY29uc3QgcGFyZW50ID0gd2luZG93LnRvcCB8fCB3aW5kb3cucGFyZW50IHx8IHdpbmRvdy5vcGVuZXI7CiAgaWYgKCFwYXJlbnQpCiAgICByZXR1cm47CiAgcmV0dXJuIGNhbGxQcm94eSh7CiAgICB3aW46IHBhcmVudCwKICAgIHNlcnZpY2VJZDogTk9USUZJQ0FUSU9OX1NFUlZJQ0UsCiAgICBtZXRob2Q6ICJpZnJhbWVMb2FkaW5nTW9kdWxlIiwKICAgIHBheWxvYWQ6IFttb2R1bGVOYW1lMiwgZXh0cmFJbmZvXQogIH0pOwp9OwpmdW5jdGlvbiBnZW5lcmF0ZVBsdWdpbnMocGx1Z2luc1NlcnZpY2VJZCkgewogIGNvbnN0IHBhcmVudCA9IHdpbmRvdy5wYXJlbnQgfHwgd2luZG93LnRvcCB8fCB3aW5kb3cub3BlbmVyOwogIGNvbnN0IGdlbmVyYXRlTWV0aG9kID0gKGtleSwgc2VydmljZUlkKSA9PiBhc3luYyAoLi4uYXJncykgPT4gewogICAgYXdhaXQgd2FpdFByb3h5KHBhcmVudCwgc2VydmljZUlkKTsKICAgIHJldHVybiBhd2FpdCBjYWxsUHJveHkoewogICAgICB3aW46IHBhcmVudCwKICAgICAgc2VydmljZUlkLAogICAgICBtZXRob2Q6IGtleSwKICAgICAgcGF5bG9hZDogYXJncwogICAgfSk7CiAgfTsKICByZXR1cm4gcGx1Z2luc1NlcnZpY2VJZC5tYXAoKHNlcnZpY2VJZCkgPT4gewogICAgY29uc3Qga2V5cyA9IFsicmVxdWlyZSIsICJiZWZvcmVNb2R1bGVHZW5lcmF0ZSIsICJyZXNvbHZlTW9kdWxlVXJsIl07CiAgICByZXR1cm4ga2V5cy5yZWR1Y2UoKHByZSwga2V5KSA9PiB7CiAgICAgIHJldHVybiB7CiAgICAgICAgLi4ucHJlLAogICAgICAgIFtrZXldOiBnZW5lcmF0ZU1ldGhvZChrZXksIHNlcnZpY2VJZCkKICAgICAgfTsKICAgIH0sIHt9KTsKICB9KTsKfQpjb25zdCBtYW5hZ2VyID0gY3JlYXRlQW1kTWFuYWdlcih2b2lkIDAsIHZvaWQgMCwgbG9nZ2VyKTsKbWFuYWdlci5tb3VudFRvR2xvYmFsKCk7CmNvbnN0IHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3R5bGUiKTsKZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzdHlsZSk7Cm1hbmFnZXIub25Nb2R1bGVMb2FkaW5nKGlmcmFtZUxvYWRpbmdNb2R1bGUpOwpyZWdpc3RlclByb3h5KERlbW9TZXJ2aWNlTmFtZSwgewogIGRlZmluZU1vZHVsZTogYXN5bmMgKG5hbWUsIGRlcHMyLCBmYWN0b3J5MikgPT4gewogICAgbWFuYWdlci5kZWZpbmUobmFtZSwgZGVwczIsIGZhY3RvcnkyKTsKICAgIHJldHVybiB0cnVlOwogIH0sCiAgZXhlY3V0ZU1vZHVsZTogYXN5bmMgKG5hbWUpID0+IHsKICAgIGF3YWl0IG1hbmFnZXIucmVxdWlyZV8obmFtZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9LAogIHNldFN0eWxlOiBhc3luYyAoY29kZSkgPT4gewogICAgc3R5bGUuaW5uZXJIVE1MID0gY29kZTsKICAgIHJldHVybiB0cnVlOwogIH0sCiAgc2V0UGx1Z2luczogYXN5bmMgKHBsdWdpbklkcykgPT4gewogICAgY29uc3QgcGx1Z2lucyA9IGdlbmVyYXRlUGx1Z2lucyhwbHVnaW5JZHMpOwogICAgbWFuYWdlci5zZXRQbHVnaW5zKHBsdWdpbnMpOwogIH0sCiAgc2V0Qm9keUh0bWw6IGFzeW5jIChodG1sKSA9PiB7CiAgICBkb2N1bWVudC5ib2R5LmlubmVySFRNTCA9IGh0bWw7CiAgfQp9KTsKd2luZG93Lm9uZXJyb3IgPSAoZXJyKSA9PiB7CiAgY29uc29sZS5lcnJvcihlcnIpOwp9OwppZnJhbWVSZWFkeSgpOwovLyMgc291cmNlTWFwcGluZ1VSTD1pZnJhbWUuanMubWFwCg=="><\/script>\n    </head>\n    <body></body>\n</html>';return[I,`data:text/html,${encodeURIComponent(I)}`]})();return b(Z,{children:[s("style",{children:".code-sandbox-iframe {\n    border-width: 0;\n    background-color: #ffffff;\n}\n"}),s("iframe",{ref:d,className:`code-sandbox-iframe ${A||""}`,title:C,src:H,srcDoc:W,allowFullScreen:!0,style:i})]})};f.displayName="Demo",I.DefaultCodes=H,I.default=f,I.registerPlugins=I=>{const g=I.concat(new w);return g.forEach((I=>{m(I.pluginId,I)})),R=g.map((I=>I.pluginId)),R},Object.defineProperties(I,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
//# sourceMappingURL=main.umd.cjs.map
