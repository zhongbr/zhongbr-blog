---
title: '数据链路层流量控制和可靠传输机制'
tags: ['计算机网络','数据链路层']
---
# 数据链路层流量控制和可靠传输机制

较高的发送速度和较低的接收速度不匹配，也会造成传输出错，所以流量控制也是数据链路层的一项重要的工作。

## 与传输层流量控制的区别

数据链路层流量控制是点到点的流量控制，控制手段是接收端接收不下，就不向发送端发送确认帧

传输层流量控制是端到端的流量控制，控制手段是如果接收端缓存区不够，就向发送端发送窗口公告

*****

## 流量控制、可靠传输和滑动窗口机制

### 流量控制的协议

信道利用率：有效发送数据所用的时间占整个发送周期的比率。

信道利用率 = L/C/T

信号吞吐率：信号利用率*发送方的发送速率

#### 停止-等待协议（特殊的滑动窗口协议）

每发送完一个帧后就停止发送，等到接收到确认帧后继续发送。

发送效率比较低效

- 发送窗口大小 = 1
- 接收窗口大小 = 1

##### 发送帧丢失

发送完一个帧后，发送端需要启动一个定时器，如果超出一定时间仍未收到这个帧的确认帧，就要自动重传当前的发送帧。

1. 发送的帧必须有副本，便于出现丢失后重传
2. 发送帧和确认帧需要有编号

##### 确认帧丢失

如果发送方发送完帧后，接收端也正常接收，但是接收方回复的确认帧丢失，发送方在自动重传后，接收端收到重传的数据包时，会将数据包丢弃，并重新回复一个确认帧。

##### 确认帧迟到

![quicker_f36260bd-21e2-497b-a436-ee200637b394.png](https://i.loli.net/2020/08/07/4BMLlgriD2XnbIU.png)

接收方对迟到的确认帧直接丢弃，不做处理。

#### 滑动窗口协议

发送窗口：发送端维持一个连续的允许发送的帧的序号

接收窗口：接收端维持一个连续的允许接收的帧的序号

##### 后退N帧协议(GBN)

发送窗口 > 1

接收窗口 < 1

###### GBN发送方必须回应的三个事件

1. 网络层的调用
2. ACK确认帧：收到ACK确认帧代表包括当前帧在内的所有之前的帧接收方都已经接收到。
3. 超时事件：重发所有已发出但是未确认的数据帧

###### GBN接收方任务

如果正确收到N号帧，就向发送方回复一个ACK代表N号帧以及N号帧以前所有的帧都已经正确收到了

对于所有不正确的情况都是直接将帧丢弃

###### 特点

1. 累计确认（偶尔捎带确认，确认帧跟随数据一起发送给对方）
2. 接收方按序接收，接收到错误的帧时会恢复一个已经按序到达的序号最大的帧
3. 发送窗口的最大尺寸为$2^{n}-1$，接收窗口的尺寸为1

优点：

1. 信道的利用率高
2. 在一个帧未接收到时，会将这个帧后面正确到达的帧丢弃，降低传输效率

##### 选择重传协议(SR)

###### SR发送端必须响应的三个事件

1. 网络层调用
2. 接收到ACK确认帧：发送方将被确认的帧标记为已确认，如果这个帧时当前发送端窗口的下届，就可以将发送端窗口移动到其后面的第一个未被确认的帧。
3. 超时事件：每个发送出去的帧都会有一个超时计时器，超时后就会重传超时的这个帧。

###### SR接收端

对于接收窗口内帧来者不拒，失序的帧会被缓存，并返回一个确认帧。收到谁确认谁。直到序号更小的帧都被收到时才会将收到的帧批量交付给上层。接收端窗口移动到第一个未收到的帧。
