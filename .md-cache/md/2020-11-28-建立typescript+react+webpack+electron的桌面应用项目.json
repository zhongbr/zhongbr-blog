{"ast":{"type":"Document","children":[{"type":"Yaml","value":"'title': '建立typescript+react+webpack+electron的桌面应用项目'\n'tags': ['react', 'webpack', 'electron', 'typescript']\n","loc":{"start":{"line":1,"column":0},"end":{"line":5,"column":3}},"range":[0,117],"raw":"---\n'title': '建立typescript+react+webpack+electron的桌面应用项目'\n'tags': ['react', 'webpack', 'electron', 'typescript']\n\n---"},{"type":"Header","depth":1,"children":[{"type":"Str","value":"建立TypeScript+React+Webpack+Electron的桌面应用项目","loc":{"start":{"line":7,"column":2},"end":{"line":7,"column":44}},"range":[121,163],"raw":"建立TypeScript+React+Webpack+Electron的桌面应用项目"}],"loc":{"start":{"line":7,"column":0},"end":{"line":7,"column":44}},"range":[119,163],"raw":"# 建立TypeScript+React+Webpack+Electron的桌面应用项目"},{"type":"Header","depth":2,"children":[{"type":"Str","value":"项目结构","loc":{"start":{"line":9,"column":3},"end":{"line":9,"column":7}},"range":[168,172],"raw":"项目结构"}],"loc":{"start":{"line":9,"column":0},"end":{"line":9,"column":7}},"range":[165,172],"raw":"## 项目结构"},{"type":"Paragraph","children":[{"type":"Image","title":null,"url":"https://tva1.sinaimg.cn/large/0081Kckwgy1gl50vb37b1j30oi0xu77f.jpg","alt":"项目结构","loc":{"start":{"line":11,"column":0},"end":{"line":11,"column":75}},"range":[174,249],"raw":"![项目结构](https://tva1.sinaimg.cn/large/0081Kckwgy1gl50vb37b1j30oi0xu77f.jpg)"}],"loc":{"start":{"line":11,"column":0},"end":{"line":11,"column":75}},"range":[174,249],"raw":"![项目结构](https://tva1.sinaimg.cn/large/0081Kckwgy1gl50vb37b1j30oi0xu77f.jpg)"},{"type":"Header","depth":2,"children":[{"type":"Str","value":"1. 新建一个React + TypeScript的项目","loc":{"start":{"line":13,"column":3},"end":{"line":13,"column":31}},"range":[254,282],"raw":"1. 新建一个React + TypeScript的项目"}],"loc":{"start":{"line":13,"column":0},"end":{"line":13,"column":31}},"range":[251,282],"raw":"## 1. 新建一个React + TypeScript的项目"},{"type":"Paragraph","children":[{"type":"Str","value":"使用 create-react-app 命令，新建一个React + TypeScript项目","loc":{"start":{"line":15,"column":0},"end":{"line":15,"column":47}},"range":[284,331],"raw":"使用 create-react-app 命令，新建一个React + TypeScript项目"}],"loc":{"start":{"line":15,"column":0},"end":{"line":15,"column":47}},"range":[284,331],"raw":"使用 create-react-app 命令，新建一个React + TypeScript项目"},{"type":"CodeBlock","lang":"bash","meta":null,"value":"create-react-app <my-project-name> --typescript","loc":{"start":{"line":17,"column":0},"end":{"line":19,"column":3}},"range":[333,392],"raw":"```bash\ncreate-react-app <my-project-name> --typescript\n```"},{"type":"Paragraph","children":[{"type":"Str","value":"<my-project-name>是项目的名称，会自动 npm install，如果自动安装依赖失败，可以手动安装依赖","loc":{"start":{"line":21,"column":0},"end":{"line":21,"column":61}},"range":[394,455],"raw":"\\<my-project-name\\>是项目的名称，会自动 npm install，如果自动安装依赖失败，可以手动安装依赖"}],"loc":{"start":{"line":21,"column":0},"end":{"line":21,"column":61}},"range":[394,455],"raw":"\\<my-project-name\\>是项目的名称，会自动 npm install，如果自动安装依赖失败，可以手动安装依赖"},{"type":"CodeBlock","lang":"bash","meta":null,"value":"npm install","loc":{"start":{"line":23,"column":0},"end":{"line":25,"column":3}},"range":[457,480],"raw":"```bash\nnpm install\n```"},{"type":"HorizontalRule","loc":{"start":{"line":27,"column":0},"end":{"line":27,"column":4}},"range":[482,486],"raw":"----"},{"type":"Header","depth":2,"children":[{"type":"Str","value":"2. 安装并配置Babel","loc":{"start":{"line":29,"column":3},"end":{"line":29,"column":16}},"range":[491,504],"raw":"2. 安装并配置Babel"}],"loc":{"start":{"line":29,"column":0},"end":{"line":29,"column":16}},"range":[488,504],"raw":"## 2. 安装并配置Babel"},{"type":"Paragraph","children":[{"type":"Str","value":"使用 create-react-app 命令创建的项目默认使用 tsc 编译文件，如果需要使用webpack打包，可以使用 babel 将TypeScript代码转换成JavaScript代码，作为一个loader配置在webpack中。","loc":{"start":{"line":31,"column":0},"end":{"line":31,"column":119}},"range":[506,625],"raw":"使用 create-react-app 命令创建的项目默认使用 tsc 编译文件，如果需要使用webpack打包，可以使用 babel 将TypeScript代码转换成JavaScript代码，作为一个loader配置在webpack中。"}],"loc":{"start":{"line":31,"column":0},"end":{"line":31,"column":119}},"range":[506,625],"raw":"使用 create-react-app 命令创建的项目默认使用 tsc 编译文件，如果需要使用webpack打包，可以使用 babel 将TypeScript代码转换成JavaScript代码，作为一个loader配置在webpack中。"},{"type":"Paragraph","children":[{"type":"Str","value":"需要安装如下的依赖","loc":{"start":{"line":33,"column":0},"end":{"line":33,"column":9}},"range":[627,636],"raw":"需要安装如下的依赖"}],"loc":{"start":{"line":33,"column":0},"end":{"line":33,"column":9}},"range":[627,636],"raw":"需要安装如下的依赖"},{"type":"CodeBlock","lang":"json","meta":null,"value":"{\n  \"devDependencies\":{\n    \"@babel/core\": \"^7.12.3\",\n  \t\"@babel/preset-env\": \"^7.12.7\",\n  \t\"@babel/preset-react\": \"^7.12.7\",\n  \t\"@babel/preset-typescript\": \"^7.12.1\",\n  }\n}","loc":{"start":{"line":35,"column":0},"end":{"line":44,"column":3}},"range":[638,823],"raw":"```json\n{\n  \"devDependencies\":{\n    \"@babel/core\": \"^7.12.3\",\n  \t\"@babel/preset-env\": \"^7.12.7\",\n  \t\"@babel/preset-react\": \"^7.12.7\",\n  \t\"@babel/preset-typescript\": \"^7.12.1\",\n  }\n}\n```"},{"type":"Paragraph","children":[{"type":"Str","value":"使用npm安装：","loc":{"start":{"line":46,"column":0},"end":{"line":46,"column":8}},"range":[825,833],"raw":"使用npm安装："}],"loc":{"start":{"line":46,"column":0},"end":{"line":46,"column":8}},"range":[825,833],"raw":"使用npm安装："},{"type":"CodeBlock","lang":"bash","meta":null,"value":"npm install --save-dev babel-loader @babel/core @babel/preset-env @babel/preset-typescript @babel/preset-react","loc":{"start":{"line":48,"column":0},"end":{"line":50,"column":3}},"range":[835,957],"raw":"```bash\nnpm install --save-dev babel-loader @babel/core @babel/preset-env @babel/preset-typescript @babel/preset-react\n```"},{"type":"Paragraph","children":[{"type":"Str","value":"在项目的根目录新建一个\".babelrc\"的Babel配置文件，并写入如下的内容","loc":{"start":{"line":52,"column":0},"end":{"line":52,"column":40}},"range":[959,999],"raw":"在项目的根目录新建一个\".babelrc\"的Babel配置文件，并写入如下的内容"}],"loc":{"start":{"line":52,"column":0},"end":{"line":52,"column":40}},"range":[959,999],"raw":"在项目的根目录新建一个\".babelrc\"的Babel配置文件，并写入如下的内容"},{"type":"CodeBlock","lang":"json","meta":null,"value":"{\n  \"presets\":[\n    \"@babel/preset-typescript\",\n    \"@babel/react\",\n    \"@babel/env\"\n  ]\n}","loc":{"start":{"line":54,"column":0},"end":{"line":62,"column":3}},"range":[1001,1103],"raw":"```json\n{\n  \"presets\":[\n    \"@babel/preset-typescript\",\n    \"@babel/react\",\n    \"@babel/env\"\n  ]\n}\n```"},{"type":"Header","depth":2,"children":[{"type":"Str","value":"3. 安装并配置Electron和webpack","loc":{"start":{"line":64,"column":3},"end":{"line":64,"column":27}},"range":[1108,1132],"raw":"3. 安装并配置Electron和webpack"}],"loc":{"start":{"line":64,"column":0},"end":{"line":64,"column":27}},"range":[1105,1132],"raw":"## 3. 安装并配置Electron和webpack"},{"type":"Paragraph","children":[{"type":"Str","value":"webpack版本: 4.x","loc":{"start":{"line":66,"column":0},"end":{"line":66,"column":14}},"range":[1134,1148],"raw":"webpack版本: 4.x"}],"loc":{"start":{"line":66,"column":0},"end":{"line":66,"column":14}},"range":[1134,1148],"raw":"webpack版本: 4.x"},{"type":"Paragraph","children":[{"type":"Str","value":"为了可以正确处理css、svg、html等静态文件，可以安装如下的plugin或者loader","loc":{"start":{"line":68,"column":0},"end":{"line":68,"column":47}},"range":[1150,1197],"raw":"为了可以正确处理css、svg、html等静态文件，可以安装如下的plugin或者loader"}],"loc":{"start":{"line":68,"column":0},"end":{"line":68,"column":47}},"range":[1150,1197],"raw":"为了可以正确处理css、svg、html等静态文件，可以安装如下的plugin或者loader"},{"type":"CodeBlock","lang":"json","meta":null,"value":"{\n  \"devDependencies\":{\n    \"webpack-html-plugin\": \"^0.1.0\",\n    \"css-loader\": \"^5.0.1\",\n    \"raw-loader\": \"^4.0.2\",\n    \"copy-webpack-plugin\": \"^6.3.2\",\n    \"file-loader\": \"^6.1.1\",\n    \"style-loader\": \"^1.3.0\"\n  }\n}","loc":{"start":{"line":70,"column":0},"end":{"line":81,"column":3}},"range":[1199,1428],"raw":"```json\n{\n  \"devDependencies\":{\n    \"webpack-html-plugin\": \"^0.1.0\",\n    \"css-loader\": \"^5.0.1\",\n    \"raw-loader\": \"^4.0.2\",\n    \"copy-webpack-plugin\": \"^6.3.2\",\n    \"file-loader\": \"^6.1.1\",\n    \"style-loader\": \"^1.3.0\"\n  }\n}\n```"},{"type":"Paragraph","children":[{"type":"Str","value":"使用npm安装","loc":{"start":{"line":83,"column":0},"end":{"line":83,"column":7}},"range":[1430,1437],"raw":"使用npm安装"}],"loc":{"start":{"line":83,"column":0},"end":{"line":83,"column":7}},"range":[1430,1437],"raw":"使用npm安装"},{"type":"CodeBlock","lang":"bash","meta":null,"value":"npm install --save-dev webpack-html-plugin@0.1.0 css-loader@5.0.1 raw-loader@4.0.2 copy-webpack-plugin@6.3.2 file-loader@6.1.1 style-loader@1.3.0","loc":{"start":{"line":85,"column":0},"end":{"line":87,"column":3}},"range":[1439,1596],"raw":"```bash\nnpm install --save-dev webpack-html-plugin@0.1.0 css-loader@5.0.1 raw-loader@4.0.2 copy-webpack-plugin@6.3.2 file-loader@6.1.1 style-loader@1.3.0\n```"},{"type":"Paragraph","children":[{"type":"Str","value":"在项目的根目录新建 webpack.ui.js 和 webpack.main.js，编辑如下的配置","loc":{"start":{"line":89,"column":0},"end":{"line":89,"column":49}},"range":[1598,1647],"raw":"在项目的根目录新建 webpack.ui.js 和 webpack.main.js，编辑如下的配置"}],"loc":{"start":{"line":89,"column":0},"end":{"line":89,"column":49}},"range":[1598,1647],"raw":"在项目的根目录新建 webpack.ui.js 和 webpack.main.js，编辑如下的配置"},{"type":"Header","depth":3,"children":[{"type":"Str","value":"I. webpack.ui.js ElectronUI进程使用的资源文件webpack打包配置","loc":{"start":{"line":91,"column":4},"end":{"line":91,"column":51}},"range":[1653,1700],"raw":"I. webpack.ui.js ElectronUI进程使用的资源文件webpack打包配置"}],"loc":{"start":{"line":91,"column":0},"end":{"line":91,"column":51}},"range":[1649,1700],"raw":"### I. webpack.ui.js ElectronUI进程使用的资源文件webpack打包配置"},{"type":"CodeBlock","lang":"javascript","meta":null,"value":"const HtmlWebpackPlugin = require('webpack-html-plugin');\nconst CopyWebpackPlugin = require('copy-webpack-plugin');\nconst path = require('path');\nmodule.exports = {\n    target: \"electron-renderer\",\n    resolve: {\n        extensions: ['.ts', '.tsx', '.d.ts', '.js', '.jsx', '.d.js', '.css']\n    },\n    entry: {\n        ui: path.resolve(__dirname, 'src','ui','index.js')\n    },\n    output: {\n        filename: '[name]_bundle.js',\n        path: path.resolve(__dirname, 'dist', 'ui')\n    },\n    module: {\n        rules: [\n            {\n                test: /\\.[t|j]sx?/,\n                use: 'babel-loader'\n            },\n            {\n                test: /\\.svg|\\.png|\\.jpg|\\.jpeg|\\.gif/,\n                use: 'file-loader'\n            },\n            {\n                test: /\\.css/,\n                use: [\n                    \"style-loader\",\n                    \"css-loader\"\n                ],\n            }\n        ]\n    },\n    plugins: [\n        // 复制静态资源\n        new CopyWebpackPlugin({\n            patterns:[{\n                from: path.resolve(__dirname, 'public'),\n                to: '.'\n            }]\n        })\n    ]\n}","loc":{"start":{"line":93,"column":0},"end":{"line":138,"column":3}},"range":[1702,2849],"raw":"```javascript\nconst HtmlWebpackPlugin = require('webpack-html-plugin');\nconst CopyWebpackPlugin = require('copy-webpack-plugin');\nconst path = require('path');\nmodule.exports = {\n    target: \"electron-renderer\",\n    resolve: {\n        extensions: ['.ts', '.tsx', '.d.ts', '.js', '.jsx', '.d.js', '.css']\n    },\n    entry: {\n        ui: path.resolve(__dirname, 'src','ui','index.js')\n    },\n    output: {\n        filename: '[name]_bundle.js',\n        path: path.resolve(__dirname, 'dist', 'ui')\n    },\n    module: {\n        rules: [\n            {\n                test: /\\.[t|j]sx?/,\n                use: 'babel-loader'\n            },\n            {\n                test: /\\.svg|\\.png|\\.jpg|\\.jpeg|\\.gif/,\n                use: 'file-loader'\n            },\n            {\n                test: /\\.css/,\n                use: [\n                    \"style-loader\",\n                    \"css-loader\"\n                ],\n            }\n        ]\n    },\n    plugins: [\n        // 复制静态资源\n        new CopyWebpackPlugin({\n            patterns:[{\n                from: path.resolve(__dirname, 'public'),\n                to: '.'\n            }]\n        })\n    ]\n}\n```"},{"type":"Paragraph","children":[{"type":"Str","value":"值得注意的是，从 ","loc":{"start":{"line":140,"column":0},"end":{"line":140,"column":9}},"range":[2851,2860],"raw":"值得注意的是，从 "},{"type":"Strong","children":[{"type":"Str","value":"copy-webpack-plugin","loc":{"start":{"line":140,"column":11},"end":{"line":140,"column":30}},"range":[2862,2881],"raw":"copy-webpack-plugin"}],"loc":{"start":{"line":140,"column":9},"end":{"line":140,"column":32}},"range":[2860,2883],"raw":"**copy-webpack-plugin**"},{"type":"Str","value":" 6开始，其配置方式改为了如下的形式，否则会报错：","loc":{"start":{"line":140,"column":32},"end":{"line":140,"column":57}},"range":[2883,2908],"raw":" 6开始，其配置方式改为了如下的形式，否则会报错："}],"loc":{"start":{"line":140,"column":0},"end":{"line":140,"column":57}},"range":[2851,2908],"raw":"值得注意的是，从 **copy-webpack-plugin** 6开始，其配置方式改为了如下的形式，否则会报错："},{"type":"CodeBlock","lang":"javascript","meta":null,"value":"const CopyWebpackPlugin = require('copy-webpack-plugin');\nnew CopyWebpackPlugin({\n  patterns:[\n    {\n      from: 'xxx',\n      to: 'xxx'\n    }\n  ]\n})","loc":{"start":{"line":142,"column":0},"end":{"line":152,"column":3}},"range":[2910,3076],"raw":"```javascript\nconst CopyWebpackPlugin = require('copy-webpack-plugin');\nnew CopyWebpackPlugin({\n  patterns:[\n    {\n      from: 'xxx',\n      to: 'xxx'\n    }\n  ]\n})\n```"},{"type":"CodeBlock","lang":"b","meta":null,"value":"[webpack-cli] ValidationError: Invalid options object. Copy Plugin has been initialized using an options object that does not match the API schema.\n - options[0] misses the property 'patterns'. Should be:\n   [non-empty string | object { from, to?, context?, globOptions?, filter?, toType?, force?, flatten?, transform?, cacheTransform?, transformPath?, noErrorOnMissing? }, ...] (should not have fewer than 1 item)\n    at validate (/Users/zhongbr/Documents/node_study/test2/node_modules/copy-webpack-plugin/node_modules/schema-utils/dist/validate.js:104:11)\n    at new CopyPlugin (/Users/zhongbr/Documents/node_study/test2/node_modules/copy-webpack-plugin/dist/index.js:54:31)\n    at Object.<anonymous> (/Users/zhongbr/Documents/node_study/test2/webpack.config.js:35:9)\n    at Module._compile (/Users/zhongbr/Documents/node_study/test2/node_modules/v8-compile-cache/v8-compile-cache.js:192:30)\n    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1131:10)\n    at Module.load (node:internal/modules/cjs/loader:967:32)\n    at Function.Module._load (node:internal/modules/cjs/loader:807:14)\n    at Module.require (node:internal/modules/cjs/loader:991:19)\n    at require (/Users/zhongbr/Documents/node_study/test2/node_modules/v8-compile-cache/v8-compile-cache.js:159:20)\n    at requireConfig (/Users/zhongbr/Documents/node_study/test2/node_modules/webpack-cli/lib/groups/resolveConfig.js:73:18)\n    at Array.map (<anonymous>)\n    at resolveConfigFiles (/Users/zhongbr/Documents/node_study/test2/node_modules/webpack-cli/lib/groups/resolveConfig.js:124:40)\n    at module.exports (/Users/zhongbr/Documents/node_study/test2/node_modules/webpack-cli/lib/groups/resolveConfig.js:247:11)\n    at WebpackCLI._baseResolver (/Users/zhongbr/Documents/node_study/test2/node_modules/webpack-cli/lib/webpack-cli.js:53:38)\n    at /Users/zhongbr/Documents/node_study/test2/node_modules/webpack-cli/lib/webpack-cli.js:149:30\n    at async WebpackCLI.runOptionGroups (/Users/zhongbr/Documents/node_study/test2/node_modules/webpack-cli/lib/webpack-cli.js:148:9)\n    at async WebpackCLI.run (/Users/zhongbr/Documents/node_study/test2/node_modules/webpack-cli/lib/webpack-cli.js:191:9)\n    at async runCLI (/Users/zhongbr/Documents/node_study/test2/node_modules/webpack-cli/lib/bootstrap.js:59:9) {\n  errors: [\n    {\n      keyword: 'required',\n      dataPath: '[0]',\n      schemaPath: '#/required',\n      params: [Object],\n      message: \"should have required property 'patterns'\",\n      schema: [Object],\n      parentSchema: [Object],\n      data: [Object],\n      children: [Array]\n    }\n  ],\n  schema: {\n    definitions: { ObjectPattern: [Object], StringPattern: [Object] },\n    type: 'object',\n    additionalProperties: false,\n    properties: { patterns: [Object], options: [Object] },\n    required: [ 'patterns' ]\n  },\n  headerName: 'Copy Plugin',\n  baseDataPath: 'options',\n  postFormatter: null\n}\n","loc":{"start":{"line":154,"column":0},"end":{"line":201,"column":3}},"range":[3078,5982],"raw":"```b\n[webpack-cli] ValidationError: Invalid options object. Copy Plugin has been initialized using an options object that does not match the API schema.\n - options[0] misses the property 'patterns'. Should be:\n   [non-empty string | object { from, to?, context?, globOptions?, filter?, toType?, force?, flatten?, transform?, cacheTransform?, transformPath?, noErrorOnMissing? }, ...] (should not have fewer than 1 item)\n    at validate (/Users/zhongbr/Documents/node_study/test2/node_modules/copy-webpack-plugin/node_modules/schema-utils/dist/validate.js:104:11)\n    at new CopyPlugin (/Users/zhongbr/Documents/node_study/test2/node_modules/copy-webpack-plugin/dist/index.js:54:31)\n    at Object.<anonymous> (/Users/zhongbr/Documents/node_study/test2/webpack.config.js:35:9)\n    at Module._compile (/Users/zhongbr/Documents/node_study/test2/node_modules/v8-compile-cache/v8-compile-cache.js:192:30)\n    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1131:10)\n    at Module.load (node:internal/modules/cjs/loader:967:32)\n    at Function.Module._load (node:internal/modules/cjs/loader:807:14)\n    at Module.require (node:internal/modules/cjs/loader:991:19)\n    at require (/Users/zhongbr/Documents/node_study/test2/node_modules/v8-compile-cache/v8-compile-cache.js:159:20)\n    at requireConfig (/Users/zhongbr/Documents/node_study/test2/node_modules/webpack-cli/lib/groups/resolveConfig.js:73:18)\n    at Array.map (<anonymous>)\n    at resolveConfigFiles (/Users/zhongbr/Documents/node_study/test2/node_modules/webpack-cli/lib/groups/resolveConfig.js:124:40)\n    at module.exports (/Users/zhongbr/Documents/node_study/test2/node_modules/webpack-cli/lib/groups/resolveConfig.js:247:11)\n    at WebpackCLI._baseResolver (/Users/zhongbr/Documents/node_study/test2/node_modules/webpack-cli/lib/webpack-cli.js:53:38)\n    at /Users/zhongbr/Documents/node_study/test2/node_modules/webpack-cli/lib/webpack-cli.js:149:30\n    at async WebpackCLI.runOptionGroups (/Users/zhongbr/Documents/node_study/test2/node_modules/webpack-cli/lib/webpack-cli.js:148:9)\n    at async WebpackCLI.run (/Users/zhongbr/Documents/node_study/test2/node_modules/webpack-cli/lib/webpack-cli.js:191:9)\n    at async runCLI (/Users/zhongbr/Documents/node_study/test2/node_modules/webpack-cli/lib/bootstrap.js:59:9) {\n  errors: [\n    {\n      keyword: 'required',\n      dataPath: '[0]',\n      schemaPath: '#/required',\n      params: [Object],\n      message: \"should have required property 'patterns'\",\n      schema: [Object],\n      parentSchema: [Object],\n      data: [Object],\n      children: [Array]\n    }\n  ],\n  schema: {\n    definitions: { ObjectPattern: [Object], StringPattern: [Object] },\n    type: 'object',\n    additionalProperties: false,\n    properties: { patterns: [Object], options: [Object] },\n    required: [ 'patterns' ]\n  },\n  headerName: 'Copy Plugin',\n  baseDataPath: 'options',\n  postFormatter: null\n}\n\n```"},{"type":"Header","depth":3,"children":[{"type":"Str","value":"II. webpack.main.js Electron逻辑进程使用的webpack打包配置","loc":{"start":{"line":203,"column":4},"end":{"line":203,"column":50}},"range":[5988,6034],"raw":"II. webpack.main.js Electron逻辑进程使用的webpack打包配置"}],"loc":{"start":{"line":203,"column":0},"end":{"line":203,"column":50}},"range":[5984,6034],"raw":"### II. webpack.main.js Electron逻辑进程使用的webpack打包配置"},{"type":"CodeBlock","lang":"javascript","meta":null,"value":"const path = require('path');\nmodule.exports = {\n    target: \"electron-main\", // 指明是要打包到electron的main\n    entry: path.resolve(__dirname, \"src\", \"main\", \"main.ts\"),\n    output: {\n        path: path.resolve(__dirname, \"dist\"),\n        filename: \"main.js\"\n    },\n    resolve:{\n        extensions: ['.ts', '.js']\n    },\n    module:{\n        rules:[\n            {\n                test: /\\.ts|\\.js/,\n                use: 'babel-loader'\n            }\n        ]\n    }\n}","loc":{"start":{"line":205,"column":0},"end":{"line":226,"column":3}},"range":[6036,6515],"raw":"```javascript\nconst path = require('path');\nmodule.exports = {\n    target: \"electron-main\", // 指明是要打包到electron的main\n    entry: path.resolve(__dirname, \"src\", \"main\", \"main.ts\"),\n    output: {\n        path: path.resolve(__dirname, \"dist\"),\n        filename: \"main.js\"\n    },\n    resolve:{\n        extensions: ['.ts', '.js']\n    },\n    module:{\n        rules:[\n            {\n                test: /\\.ts|\\.js/,\n                use: 'babel-loader'\n            }\n        ]\n    }\n}\n```"},{"type":"Header","depth":3,"children":[{"type":"Str","value":"III. 修改public下的index.html为如下的内容","loc":{"start":{"line":230,"column":4},"end":{"line":230,"column":35}},"range":[6523,6554],"raw":"III. 修改public下的index.html为如下的内容"}],"loc":{"start":{"line":230,"column":0},"end":{"line":230,"column":35}},"range":[6519,6554],"raw":"### III. 修改public下的index.html为如下的内容"},{"type":"Paragraph","children":[{"type":"Str","value":"将%PUBLIC_PATH%全部替换成\".\"","loc":{"start":{"line":232,"column":0},"end":{"line":232,"column":22}},"range":[6556,6578],"raw":"将%PUBLIC_PATH%全部替换成\".\""}],"loc":{"start":{"line":232,"column":0},"end":{"line":232,"column":22}},"range":[6556,6578],"raw":"将%PUBLIC_PATH%全部替换成\".\""},{"type":"CodeBlock","lang":"html","meta":null,"value":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\" />\n  <link rel=\"icon\" href=\"./favicon.ico\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n  <meta name=\"theme-color\" content=\"#000000\" />\n  <meta\n          name=\"description\"\n          content=\"Web site created using create-react-app\"\n  />\n  <link rel=\"apple-touch-icon\" href=\"./logo192.png\" />\n  <!--\n    manifest.json provides metadata used when your web app is installed on a\n    user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/\n  -->\n  <link rel=\"manifest\" href=\"./manifest.json\" />\n  <!--\n    Notice the use of %PUBLIC_URL% in the tags above.\n    It will be replaced with the URL of the `public` folder during the build.\n    Only files inside the `public` folder can be referenced from the HTML.\n\n    Unlike \"/favicon.ico\" or \"favicon.ico\", \"%PUBLIC_URL%/favicon.ico\" will\n    work correctly both with client-side routing and a non-root public URL.\n    Learn how to configure a non-root public URL by running `npm run build`.\n  -->\n  <title>React App</title>\n</head>\n<body>\n<noscript>You need to enable JavaScript to run this app.</noscript>\n<div id=\"root\"></div>\n<!--\n  This HTML file is a template.\n  If you open it directly in the browser, you will see an empty page.\n\n  You can add webfonts, meta tags, or analytics to this file.\n  The build step will place the bundled scripts into the <body> tag.\n\n  To begin the development, run `npm start` or `yarn start`.\n  To create a production bundle, use `npm run build` or `yarn build`.\n-->\n<script src=\"./ui_bundle.js\"></script>\n</body>\n</html>\n","loc":{"start":{"line":234,"column":0},"end":{"line":280,"column":3}},"range":[6580,8237],"raw":"```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\" />\n  <link rel=\"icon\" href=\"./favicon.ico\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n  <meta name=\"theme-color\" content=\"#000000\" />\n  <meta\n          name=\"description\"\n          content=\"Web site created using create-react-app\"\n  />\n  <link rel=\"apple-touch-icon\" href=\"./logo192.png\" />\n  <!--\n    manifest.json provides metadata used when your web app is installed on a\n    user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/\n  -->\n  <link rel=\"manifest\" href=\"./manifest.json\" />\n  <!--\n    Notice the use of %PUBLIC_URL% in the tags above.\n    It will be replaced with the URL of the `public` folder during the build.\n    Only files inside the `public` folder can be referenced from the HTML.\n\n    Unlike \"/favicon.ico\" or \"favicon.ico\", \"%PUBLIC_URL%/favicon.ico\" will\n    work correctly both with client-side routing and a non-root public URL.\n    Learn how to configure a non-root public URL by running `npm run build`.\n  -->\n  <title>React App</title>\n</head>\n<body>\n<noscript>You need to enable JavaScript to run this app.</noscript>\n<div id=\"root\"></div>\n<!--\n  This HTML file is a template.\n  If you open it directly in the browser, you will see an empty page.\n\n  You can add webfonts, meta tags, or analytics to this file.\n  The build step will place the bundled scripts into the <body> tag.\n\n  To begin the development, run `npm start` or `yarn start`.\n  To create a production bundle, use `npm run build` or `yarn build`.\n-->\n<script src=\"./ui_bundle.js\"></script>\n</body>\n</html>\n\n```"},{"type":"Header","depth":3,"children":[{"type":"Str","value":"IV. 在src/main下新建一个main.ts作为逻辑进程","loc":{"start":{"line":284,"column":4},"end":{"line":284,"column":35}},"range":[8245,8276],"raw":"IV. 在src/main下新建一个main.ts作为逻辑进程"}],"loc":{"start":{"line":284,"column":0},"end":{"line":284,"column":35}},"range":[8241,8276],"raw":"### IV. 在src/main下新建一个main.ts作为逻辑进程"},{"type":"Paragraph","children":[{"type":"Str","value":"main.ts的代码如下：","loc":{"start":{"line":286,"column":0},"end":{"line":286,"column":13}},"range":[8278,8291],"raw":"main.ts的代码如下："}],"loc":{"start":{"line":286,"column":0},"end":{"line":286,"column":13}},"range":[8278,8291],"raw":"main.ts的代码如下："},{"type":"CodeBlock","lang":"typescript","meta":null,"value":"import { app, BrowserWindow } from \"electron\";\nimport * as path from \"path\";\n\nfunction createWindow() {\n    // Create the browser window.\n    const mainWindow = new BrowserWindow({\n        height: 600,\n        webPreferences: {\n            preload: path.join(__dirname, \"preload.js\"),\n        },\n        width: 800,\n    });\n\n    // and load the index.html of the app.\n    // mainWindow.loadFile(path.join(__dirname, \"../index.html\"));\n    if(!app.isPackaged){\n        mainWindow.loadFile(path.join(\"./ui/index.html\")).then(r => {})\n        // mainWindow.loadURL('http://localhost:8080').then();\n    }\n    // Open the DevTools.\n    mainWindow.webContents.openDevTools();\n}\n\n// This method will be called when Electron has finished\n// initialization and is ready to create browser windows.\n// Some APIs can only be used after this event occurs.\napp.on(\"ready\", () => {\n    createWindow();\n\n    app.on(\"activate\", function () {\n        // On macOS it's common to re-create a window in the app when the\n        // dock icon is clicked and there are no other windows open.\n        if (BrowserWindow.getAllWindows().length === 0) createWindow();\n    });\n});\n\n// Quit when all windows are closed, except on macOS. There, it's common\n// for applications and their menu bar to stay active until the user quits\n// explicitly with Cmd + Q.\napp.on(\"window-all-closed\", () => {\n    if (process.platform !== \"darwin\") {\n        app.quit();\n    }\n});\n\n// In this file you can include the rest of your app\"s specific main process\n// code. You can also put them in separate files and require them here.\n","loc":{"start":{"line":288,"column":0},"end":{"line":337,"column":3}},"range":[8293,9897],"raw":"```typescript\nimport { app, BrowserWindow } from \"electron\";\nimport * as path from \"path\";\n\nfunction createWindow() {\n    // Create the browser window.\n    const mainWindow = new BrowserWindow({\n        height: 600,\n        webPreferences: {\n            preload: path.join(__dirname, \"preload.js\"),\n        },\n        width: 800,\n    });\n\n    // and load the index.html of the app.\n    // mainWindow.loadFile(path.join(__dirname, \"../index.html\"));\n    if(!app.isPackaged){\n        mainWindow.loadFile(path.join(\"./ui/index.html\")).then(r => {})\n        // mainWindow.loadURL('http://localhost:8080').then();\n    }\n    // Open the DevTools.\n    mainWindow.webContents.openDevTools();\n}\n\n// This method will be called when Electron has finished\n// initialization and is ready to create browser windows.\n// Some APIs can only be used after this event occurs.\napp.on(\"ready\", () => {\n    createWindow();\n\n    app.on(\"activate\", function () {\n        // On macOS it's common to re-create a window in the app when the\n        // dock icon is clicked and there are no other windows open.\n        if (BrowserWindow.getAllWindows().length === 0) createWindow();\n    });\n});\n\n// Quit when all windows are closed, except on macOS. There, it's common\n// for applications and their menu bar to stay active until the user quits\n// explicitly with Cmd + Q.\napp.on(\"window-all-closed\", () => {\n    if (process.platform !== \"darwin\") {\n        app.quit();\n    }\n});\n\n// In this file you can include the rest of your app\"s specific main process\n// code. You can also put them in separate files and require them here.\n\n```"},{"type":"Header","depth":2,"children":[{"type":"Str","value":"4. 在Package.json中添加启动和调试脚本","loc":{"start":{"line":341,"column":3},"end":{"line":341,"column":29}},"range":[9904,9930],"raw":"4. 在Package.json中添加启动和调试脚本"}],"loc":{"start":{"line":341,"column":0},"end":{"line":341,"column":29}},"range":[9901,9930],"raw":"## 4. 在Package.json中添加启动和调试脚本"},{"type":"Paragraph","children":[{"type":"Str","value":"安装electron，并添加启动脚本到pakage.json中","loc":{"start":{"line":343,"column":0},"end":{"line":343,"column":31}},"range":[9932,9963],"raw":"安装electron，并添加启动脚本到pakage.json中"}],"loc":{"start":{"line":343,"column":0},"end":{"line":343,"column":31}},"range":[9932,9963],"raw":"安装electron，并添加启动脚本到pakage.json中"},{"type":"CodeBlock","lang":"json","meta":null,"value":"{\n  \"scripts\":{\n    \"ebuild\": \"webpack --config webpack.ui.js && webpack --config webpack.main.js && electron dist/main.js\"\n  }\n}","loc":{"start":{"line":345,"column":0},"end":{"line":351,"column":3}},"range":[9965,10106],"raw":"```json\n{\n  \"scripts\":{\n    \"ebuild\": \"webpack --config webpack.ui.js && webpack --config webpack.main.js && electron dist/main.js\"\n  }\n}\n```"},{"type":"Paragraph","children":[{"type":"Str","value":"然后运行，即可启动electron窗口","loc":{"start":{"line":353,"column":0},"end":{"line":353,"column":19}},"range":[10108,10127],"raw":"然后运行，即可启动electron窗口"}],"loc":{"start":{"line":353,"column":0},"end":{"line":353,"column":19}},"range":[10108,10127],"raw":"然后运行，即可启动electron窗口"},{"type":"CodeBlock","lang":"bash","meta":null,"value":"npm run ebuild","loc":{"start":{"line":355,"column":0},"end":{"line":357,"column":3}},"range":[10129,10155],"raw":"```bash\nnpm run ebuild\n```"},{"type":"Paragraph","children":[{"type":"Str","value":"如果遇到报错提示Electron未正确安装时，可以尝试向node_modules/electron目录中添加一个path.txt，其中的内容是 electron的可执行文件的路径，并添加如下的环境变量","loc":{"start":{"line":359,"column":0},"end":{"line":359,"column":100}},"range":[10157,10257],"raw":"如果遇到报错提示Electron未正确安装时，可以尝试向node_modules/electron目录中添加一个path.txt，其中的内容是 electron的可执行文件的路径，并添加如下的环境变量"}],"loc":{"start":{"line":359,"column":0},"end":{"line":359,"column":100}},"range":[10157,10257],"raw":"如果遇到报错提示Electron未正确安装时，可以尝试向node_modules/electron目录中添加一个path.txt，其中的内容是 electron的可执行文件的路径，并添加如下的环境变量"},{"type":"CodeBlock","lang":"bash","meta":null,"value":"# 报错\nElectron failed to install correctly, please delete node_modules/electron and try installing again\n# path.txt的内容示例\nElectron.app/Contents/MacOS/Electron\n# 添加的环境变量\nexport ELECTRON_OVERRIDE_DIST_PATH=/usr/local/Cellar/nvm/0.37.0/versions/node/v15.2.1/lib/node_modules/electron/dist","loc":{"start":{"line":361,"column":0},"end":{"line":368,"column":3}},"range":[10259,10554],"raw":"```bash\n# 报错\nElectron failed to install correctly, please delete node_modules/electron and try installing again\n# path.txt的内容示例\nElectron.app/Contents/MacOS/Electron\n# 添加的环境变量\nexport ELECTRON_OVERRIDE_DIST_PATH=/usr/local/Cellar/nvm/0.37.0/versions/node/v15.2.1/lib/node_modules/electron/dist\n```"},{"type":"Paragraph","children":[{"type":"Str","value":"为了便于开发，做到在修改了ui的代码后，electron可以自动更新，可以借助 nodemon 包，其npm安装命令如下","loc":{"start":{"line":370,"column":0},"end":{"line":370,"column":60}},"range":[10556,10616],"raw":"为了便于开发，做到在修改了ui的代码后，electron可以自动更新，可以借助 nodemon 包，其npm安装命令如下"}],"loc":{"start":{"line":370,"column":0},"end":{"line":370,"column":60}},"range":[10556,10616],"raw":"为了便于开发，做到在修改了ui的代码后，electron可以自动更新，可以借助 nodemon 包，其npm安装命令如下"},{"type":"CodeBlock","lang":"bash","meta":null,"value":"npm install --save-dev nodemon","loc":{"start":{"line":372,"column":0},"end":{"line":374,"column":3}},"range":[10618,10660],"raw":"```bash\nnpm install --save-dev nodemon\n```"},{"type":"Header","depth":2,"children":[{"type":"Str","value":"附 · 完整的package.json文件","loc":{"start":{"line":378,"column":3},"end":{"line":378,"column":24}},"range":[10667,10688],"raw":"附 · 完整的package.json文件"}],"loc":{"start":{"line":378,"column":0},"end":{"line":378,"column":24}},"range":[10664,10688],"raw":"## 附 · 完整的package.json文件"},{"type":"CodeBlock","lang":"json","meta":null,"value":"{\n  \"name\": \"test2\",\n  \"version\": \"0.1.0\",\n  \"private\": true,\n  \"dependencies\": {\n    \"@testing-library/jest-dom\": \"^5.11.6\",\n    \"@testing-library/react\": \"^11.2.2\",\n    \"@testing-library/user-event\": \"^12.2.2\",\n    \"@types/jest\": \"^26.0.15\",\n    \"@types/node\": \"^12.19.7\",\n    \"@types/react\": \"^16.14.2\",\n    \"@types/react-dom\": \"^16.9.10\",\n    \"react\": \"^17.0.1\",\n    \"react-dom\": \"^17.0.1\",\n    \"react-scripts\": \"4.0.1\",\n    \"typescript\": \"^4.1.2\",\n    \"web-vitals\": \"^0.2.4\"\n  },\n  \"scripts\": {\n    \"start\": \"react-scripts start\",\n    \"build\": \"react-scripts build\",\n    \"test\": \"react-scripts test\",\n    \"eject\": \"react-scripts eject\",\n    \"ebuild\": \"webpack --config webpack.ui.js && webpack --config webpack.main.js && electron dist/main.js --inspect=8888\"\n  },\n  \"eslintConfig\": {\n    \"extends\": [\n      \"react-app\",\n      \"react-app/jest\"\n    ]\n  },\n  \"browserslist\": {\n    \"production\": [\n      \">0.2%\",\n      \"not dead\",\n      \"not op_mini all\"\n    ],\n    \"development\": [\n      \"last 1 chrome version\",\n      \"last 1 firefox version\",\n      \"last 1 safari version\"\n    ]\n  },\n  \"devDependencies\": {\n    \"@babel/core\": \"^7.12.3\",\n    \"@babel/preset-env\": \"^7.12.7\",\n    \"@babel/preset-react\": \"^7.12.7\",\n    \"@babel/preset-typescript\": \"^7.12.1\",\n    \"babel-loader\": \"^8.1.0\",\n    \"copy-webpack-plugin\": \"^6.3.2\",\n    \"css-loader\": \"^5.0.1\",\n    \"electron\": \"^11.0.3\",\n    \"file-loader\": \"^6.1.1\",\n    \"nodemon\": \"^2.0.6\",\n    \"style-loader\": \"^1.3.0\",\n    \"webpack-cli\": \"^4.2.0\"\n  }\n}","loc":{"start":{"line":380,"column":0},"end":{"line":439,"column":3}},"range":[10690,12200],"raw":"```json\n{\n  \"name\": \"test2\",\n  \"version\": \"0.1.0\",\n  \"private\": true,\n  \"dependencies\": {\n    \"@testing-library/jest-dom\": \"^5.11.6\",\n    \"@testing-library/react\": \"^11.2.2\",\n    \"@testing-library/user-event\": \"^12.2.2\",\n    \"@types/jest\": \"^26.0.15\",\n    \"@types/node\": \"^12.19.7\",\n    \"@types/react\": \"^16.14.2\",\n    \"@types/react-dom\": \"^16.9.10\",\n    \"react\": \"^17.0.1\",\n    \"react-dom\": \"^17.0.1\",\n    \"react-scripts\": \"4.0.1\",\n    \"typescript\": \"^4.1.2\",\n    \"web-vitals\": \"^0.2.4\"\n  },\n  \"scripts\": {\n    \"start\": \"react-scripts start\",\n    \"build\": \"react-scripts build\",\n    \"test\": \"react-scripts test\",\n    \"eject\": \"react-scripts eject\",\n    \"ebuild\": \"webpack --config webpack.ui.js && webpack --config webpack.main.js && electron dist/main.js --inspect=8888\"\n  },\n  \"eslintConfig\": {\n    \"extends\": [\n      \"react-app\",\n      \"react-app/jest\"\n    ]\n  },\n  \"browserslist\": {\n    \"production\": [\n      \">0.2%\",\n      \"not dead\",\n      \"not op_mini all\"\n    ],\n    \"development\": [\n      \"last 1 chrome version\",\n      \"last 1 firefox version\",\n      \"last 1 safari version\"\n    ]\n  },\n  \"devDependencies\": {\n    \"@babel/core\": \"^7.12.3\",\n    \"@babel/preset-env\": \"^7.12.7\",\n    \"@babel/preset-react\": \"^7.12.7\",\n    \"@babel/preset-typescript\": \"^7.12.1\",\n    \"babel-loader\": \"^8.1.0\",\n    \"copy-webpack-plugin\": \"^6.3.2\",\n    \"css-loader\": \"^5.0.1\",\n    \"electron\": \"^11.0.3\",\n    \"file-loader\": \"^6.1.1\",\n    \"nodemon\": \"^2.0.6\",\n    \"style-loader\": \"^1.3.0\",\n    \"webpack-cli\": \"^4.2.0\"\n  }\n}\n```"}],"loc":{"start":{"line":1,"column":0},"end":{"line":443,"column":0}},"range":[0,12204],"raw":"---\n'title': '建立typescript+react+webpack+electron的桌面应用项目'\n'tags': ['react', 'webpack', 'electron', 'typescript']\n\n---\n\n# 建立TypeScript+React+Webpack+Electron的桌面应用项目\n\n## 项目结构\n\n![项目结构](https://tva1.sinaimg.cn/large/0081Kckwgy1gl50vb37b1j30oi0xu77f.jpg)\n\n## 1. 新建一个React + TypeScript的项目\n\n使用 create-react-app 命令，新建一个React + TypeScript项目\n\n```bash\ncreate-react-app <my-project-name> --typescript\n```\n\n\\<my-project-name\\>是项目的名称，会自动 npm install，如果自动安装依赖失败，可以手动安装依赖\n\n```bash\nnpm install\n```\n\n----\n\n## 2. 安装并配置Babel\n\n使用 create-react-app 命令创建的项目默认使用 tsc 编译文件，如果需要使用webpack打包，可以使用 babel 将TypeScript代码转换成JavaScript代码，作为一个loader配置在webpack中。\n\n需要安装如下的依赖\n\n```json\n{\n  \"devDependencies\":{\n    \"@babel/core\": \"^7.12.3\",\n  \t\"@babel/preset-env\": \"^7.12.7\",\n  \t\"@babel/preset-react\": \"^7.12.7\",\n  \t\"@babel/preset-typescript\": \"^7.12.1\",\n  }\n}\n```\n\n使用npm安装：\n\n```bash\nnpm install --save-dev babel-loader @babel/core @babel/preset-env @babel/preset-typescript @babel/preset-react\n```\n\n在项目的根目录新建一个\".babelrc\"的Babel配置文件，并写入如下的内容\n\n```json\n{\n  \"presets\":[\n    \"@babel/preset-typescript\",\n    \"@babel/react\",\n    \"@babel/env\"\n  ]\n}\n```\n\n## 3. 安装并配置Electron和webpack\n\nwebpack版本: 4.x\n\n为了可以正确处理css、svg、html等静态文件，可以安装如下的plugin或者loader\n\n```json\n{\n  \"devDependencies\":{\n    \"webpack-html-plugin\": \"^0.1.0\",\n    \"css-loader\": \"^5.0.1\",\n    \"raw-loader\": \"^4.0.2\",\n    \"copy-webpack-plugin\": \"^6.3.2\",\n    \"file-loader\": \"^6.1.1\",\n    \"style-loader\": \"^1.3.0\"\n  }\n}\n```\n\n使用npm安装\n\n```bash\nnpm install --save-dev webpack-html-plugin@0.1.0 css-loader@5.0.1 raw-loader@4.0.2 copy-webpack-plugin@6.3.2 file-loader@6.1.1 style-loader@1.3.0\n```\n\n在项目的根目录新建 webpack.ui.js 和 webpack.main.js，编辑如下的配置\n\n### I. webpack.ui.js ElectronUI进程使用的资源文件webpack打包配置\n\n```javascript\nconst HtmlWebpackPlugin = require('webpack-html-plugin');\nconst CopyWebpackPlugin = require('copy-webpack-plugin');\nconst path = require('path');\nmodule.exports = {\n    target: \"electron-renderer\",\n    resolve: {\n        extensions: ['.ts', '.tsx', '.d.ts', '.js', '.jsx', '.d.js', '.css']\n    },\n    entry: {\n        ui: path.resolve(__dirname, 'src','ui','index.js')\n    },\n    output: {\n        filename: '[name]_bundle.js',\n        path: path.resolve(__dirname, 'dist', 'ui')\n    },\n    module: {\n        rules: [\n            {\n                test: /\\.[t|j]sx?/,\n                use: 'babel-loader'\n            },\n            {\n                test: /\\.svg|\\.png|\\.jpg|\\.jpeg|\\.gif/,\n                use: 'file-loader'\n            },\n            {\n                test: /\\.css/,\n                use: [\n                    \"style-loader\",\n                    \"css-loader\"\n                ],\n            }\n        ]\n    },\n    plugins: [\n        // 复制静态资源\n        new CopyWebpackPlugin({\n            patterns:[{\n                from: path.resolve(__dirname, 'public'),\n                to: '.'\n            }]\n        })\n    ]\n}\n```\n\n值得注意的是，从 **copy-webpack-plugin** 6开始，其配置方式改为了如下的形式，否则会报错：\n\n```javascript\nconst CopyWebpackPlugin = require('copy-webpack-plugin');\nnew CopyWebpackPlugin({\n  patterns:[\n    {\n      from: 'xxx',\n      to: 'xxx'\n    }\n  ]\n})\n```\n\n```b\n[webpack-cli] ValidationError: Invalid options object. Copy Plugin has been initialized using an options object that does not match the API schema.\n - options[0] misses the property 'patterns'. Should be:\n   [non-empty string | object { from, to?, context?, globOptions?, filter?, toType?, force?, flatten?, transform?, cacheTransform?, transformPath?, noErrorOnMissing? }, ...] (should not have fewer than 1 item)\n    at validate (/Users/zhongbr/Documents/node_study/test2/node_modules/copy-webpack-plugin/node_modules/schema-utils/dist/validate.js:104:11)\n    at new CopyPlugin (/Users/zhongbr/Documents/node_study/test2/node_modules/copy-webpack-plugin/dist/index.js:54:31)\n    at Object.<anonymous> (/Users/zhongbr/Documents/node_study/test2/webpack.config.js:35:9)\n    at Module._compile (/Users/zhongbr/Documents/node_study/test2/node_modules/v8-compile-cache/v8-compile-cache.js:192:30)\n    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1131:10)\n    at Module.load (node:internal/modules/cjs/loader:967:32)\n    at Function.Module._load (node:internal/modules/cjs/loader:807:14)\n    at Module.require (node:internal/modules/cjs/loader:991:19)\n    at require (/Users/zhongbr/Documents/node_study/test2/node_modules/v8-compile-cache/v8-compile-cache.js:159:20)\n    at requireConfig (/Users/zhongbr/Documents/node_study/test2/node_modules/webpack-cli/lib/groups/resolveConfig.js:73:18)\n    at Array.map (<anonymous>)\n    at resolveConfigFiles (/Users/zhongbr/Documents/node_study/test2/node_modules/webpack-cli/lib/groups/resolveConfig.js:124:40)\n    at module.exports (/Users/zhongbr/Documents/node_study/test2/node_modules/webpack-cli/lib/groups/resolveConfig.js:247:11)\n    at WebpackCLI._baseResolver (/Users/zhongbr/Documents/node_study/test2/node_modules/webpack-cli/lib/webpack-cli.js:53:38)\n    at /Users/zhongbr/Documents/node_study/test2/node_modules/webpack-cli/lib/webpack-cli.js:149:30\n    at async WebpackCLI.runOptionGroups (/Users/zhongbr/Documents/node_study/test2/node_modules/webpack-cli/lib/webpack-cli.js:148:9)\n    at async WebpackCLI.run (/Users/zhongbr/Documents/node_study/test2/node_modules/webpack-cli/lib/webpack-cli.js:191:9)\n    at async runCLI (/Users/zhongbr/Documents/node_study/test2/node_modules/webpack-cli/lib/bootstrap.js:59:9) {\n  errors: [\n    {\n      keyword: 'required',\n      dataPath: '[0]',\n      schemaPath: '#/required',\n      params: [Object],\n      message: \"should have required property 'patterns'\",\n      schema: [Object],\n      parentSchema: [Object],\n      data: [Object],\n      children: [Array]\n    }\n  ],\n  schema: {\n    definitions: { ObjectPattern: [Object], StringPattern: [Object] },\n    type: 'object',\n    additionalProperties: false,\n    properties: { patterns: [Object], options: [Object] },\n    required: [ 'patterns' ]\n  },\n  headerName: 'Copy Plugin',\n  baseDataPath: 'options',\n  postFormatter: null\n}\n\n```\n\n### II. webpack.main.js Electron逻辑进程使用的webpack打包配置\n\n```javascript\nconst path = require('path');\nmodule.exports = {\n    target: \"electron-main\", // 指明是要打包到electron的main\n    entry: path.resolve(__dirname, \"src\", \"main\", \"main.ts\"),\n    output: {\n        path: path.resolve(__dirname, \"dist\"),\n        filename: \"main.js\"\n    },\n    resolve:{\n        extensions: ['.ts', '.js']\n    },\n    module:{\n        rules:[\n            {\n                test: /\\.ts|\\.js/,\n                use: 'babel-loader'\n            }\n        ]\n    }\n}\n```\n\n\n\n### III. 修改public下的index.html为如下的内容\n\n将%PUBLIC_PATH%全部替换成\".\"\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\" />\n  <link rel=\"icon\" href=\"./favicon.ico\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n  <meta name=\"theme-color\" content=\"#000000\" />\n  <meta\n          name=\"description\"\n          content=\"Web site created using create-react-app\"\n  />\n  <link rel=\"apple-touch-icon\" href=\"./logo192.png\" />\n  <!--\n    manifest.json provides metadata used when your web app is installed on a\n    user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/\n  -->\n  <link rel=\"manifest\" href=\"./manifest.json\" />\n  <!--\n    Notice the use of %PUBLIC_URL% in the tags above.\n    It will be replaced with the URL of the `public` folder during the build.\n    Only files inside the `public` folder can be referenced from the HTML.\n\n    Unlike \"/favicon.ico\" or \"favicon.ico\", \"%PUBLIC_URL%/favicon.ico\" will\n    work correctly both with client-side routing and a non-root public URL.\n    Learn how to configure a non-root public URL by running `npm run build`.\n  -->\n  <title>React App</title>\n</head>\n<body>\n<noscript>You need to enable JavaScript to run this app.</noscript>\n<div id=\"root\"></div>\n<!--\n  This HTML file is a template.\n  If you open it directly in the browser, you will see an empty page.\n\n  You can add webfonts, meta tags, or analytics to this file.\n  The build step will place the bundled scripts into the <body> tag.\n\n  To begin the development, run `npm start` or `yarn start`.\n  To create a production bundle, use `npm run build` or `yarn build`.\n-->\n<script src=\"./ui_bundle.js\"></script>\n</body>\n</html>\n\n```\n\n\n\n### IV. 在src/main下新建一个main.ts作为逻辑进程\n\nmain.ts的代码如下：\n\n```typescript\nimport { app, BrowserWindow } from \"electron\";\nimport * as path from \"path\";\n\nfunction createWindow() {\n    // Create the browser window.\n    const mainWindow = new BrowserWindow({\n        height: 600,\n        webPreferences: {\n            preload: path.join(__dirname, \"preload.js\"),\n        },\n        width: 800,\n    });\n\n    // and load the index.html of the app.\n    // mainWindow.loadFile(path.join(__dirname, \"../index.html\"));\n    if(!app.isPackaged){\n        mainWindow.loadFile(path.join(\"./ui/index.html\")).then(r => {})\n        // mainWindow.loadURL('http://localhost:8080').then();\n    }\n    // Open the DevTools.\n    mainWindow.webContents.openDevTools();\n}\n\n// This method will be called when Electron has finished\n// initialization and is ready to create browser windows.\n// Some APIs can only be used after this event occurs.\napp.on(\"ready\", () => {\n    createWindow();\n\n    app.on(\"activate\", function () {\n        // On macOS it's common to re-create a window in the app when the\n        // dock icon is clicked and there are no other windows open.\n        if (BrowserWindow.getAllWindows().length === 0) createWindow();\n    });\n});\n\n// Quit when all windows are closed, except on macOS. There, it's common\n// for applications and their menu bar to stay active until the user quits\n// explicitly with Cmd + Q.\napp.on(\"window-all-closed\", () => {\n    if (process.platform !== \"darwin\") {\n        app.quit();\n    }\n});\n\n// In this file you can include the rest of your app\"s specific main process\n// code. You can also put them in separate files and require them here.\n\n```\n\n\n\n## 4. 在Package.json中添加启动和调试脚本\n\n安装electron，并添加启动脚本到pakage.json中\n\n```json\n{\n  \"scripts\":{\n    \"ebuild\": \"webpack --config webpack.ui.js && webpack --config webpack.main.js && electron dist/main.js\"\n  }\n}\n```\n\n然后运行，即可启动electron窗口\n\n```bash\nnpm run ebuild\n```\n\n如果遇到报错提示Electron未正确安装时，可以尝试向node_modules/electron目录中添加一个path.txt，其中的内容是 electron的可执行文件的路径，并添加如下的环境变量\n\n```bash\n# 报错\nElectron failed to install correctly, please delete node_modules/electron and try installing again\n# path.txt的内容示例\nElectron.app/Contents/MacOS/Electron\n# 添加的环境变量\nexport ELECTRON_OVERRIDE_DIST_PATH=/usr/local/Cellar/nvm/0.37.0/versions/node/v15.2.1/lib/node_modules/electron/dist\n```\n\n为了便于开发，做到在修改了ui的代码后，electron可以自动更新，可以借助 nodemon 包，其npm安装命令如下\n\n```bash\nnpm install --save-dev nodemon\n```\n\n\n\n## 附 · 完整的package.json文件\n\n```json\n{\n  \"name\": \"test2\",\n  \"version\": \"0.1.0\",\n  \"private\": true,\n  \"dependencies\": {\n    \"@testing-library/jest-dom\": \"^5.11.6\",\n    \"@testing-library/react\": \"^11.2.2\",\n    \"@testing-library/user-event\": \"^12.2.2\",\n    \"@types/jest\": \"^26.0.15\",\n    \"@types/node\": \"^12.19.7\",\n    \"@types/react\": \"^16.14.2\",\n    \"@types/react-dom\": \"^16.9.10\",\n    \"react\": \"^17.0.1\",\n    \"react-dom\": \"^17.0.1\",\n    \"react-scripts\": \"4.0.1\",\n    \"typescript\": \"^4.1.2\",\n    \"web-vitals\": \"^0.2.4\"\n  },\n  \"scripts\": {\n    \"start\": \"react-scripts start\",\n    \"build\": \"react-scripts build\",\n    \"test\": \"react-scripts test\",\n    \"eject\": \"react-scripts eject\",\n    \"ebuild\": \"webpack --config webpack.ui.js && webpack --config webpack.main.js && electron dist/main.js --inspect=8888\"\n  },\n  \"eslintConfig\": {\n    \"extends\": [\n      \"react-app\",\n      \"react-app/jest\"\n    ]\n  },\n  \"browserslist\": {\n    \"production\": [\n      \">0.2%\",\n      \"not dead\",\n      \"not op_mini all\"\n    ],\n    \"development\": [\n      \"last 1 chrome version\",\n      \"last 1 firefox version\",\n      \"last 1 safari version\"\n    ]\n  },\n  \"devDependencies\": {\n    \"@babel/core\": \"^7.12.3\",\n    \"@babel/preset-env\": \"^7.12.7\",\n    \"@babel/preset-react\": \"^7.12.7\",\n    \"@babel/preset-typescript\": \"^7.12.1\",\n    \"babel-loader\": \"^8.1.0\",\n    \"copy-webpack-plugin\": \"^6.3.2\",\n    \"css-loader\": \"^5.0.1\",\n    \"electron\": \"^11.0.3\",\n    \"file-loader\": \"^6.1.1\",\n    \"nodemon\": \"^2.0.6\",\n    \"style-loader\": \"^1.3.0\",\n    \"webpack-cli\": \"^4.2.0\"\n  }\n}\n```\n\n\n\n"},"catalogue":{"title":"建立typescript+react+webpack+electron的桌面应用项目","json-path":"2020-11-28-建立typescript+react+webpack+electron的桌面应用项目.json","mdate":"2022-09-04T15:14:38.134Z","tags":["react","webpack","electron","typescript"]}}